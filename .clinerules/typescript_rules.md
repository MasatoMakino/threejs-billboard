# TypeScript コーディング規約およびプロジェクト固有のルール

このドキュメントでは、本プロジェクト固有のTypeScriptのコーディング規約を定めます。これらのルールに従うことで、コードの品質と保守性を維持し、開発効率を向上させることを目指します。

## 1. モジュールのインポート

- PixiJSおよびThree.jsのモジュールをインポートする際は、基本的にモジュールのルートから名前付きエクスポートを使用することを推奨します。
  - 例: `import { Container, Ticker } from 'pixi.js';`
  - 例: `import { Scene, PerspectiveCamera } from 'three';`
- ただし、Three.jsのオプションモジュールなど、特定のサブパスからのインポートが必要な例外も存在します。
  - 例: `import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';`
- ローカルのTypeScriptファイルをインポートする場合、ESMの仕様に基づき、インポートパスには `.js` 拡張子を明示的に指定してください。 例: `import { someFunction } from './someFile.js';`

## 2. 非同期処理の初期化

- `autoDetectRenderer`のように非同期で初期化が必要な機能を使用する場合は、コンストラクターではなく非同期関数（例: `init` メソッド）内で実行してください。

## 3. JavaScriptファイルでの型アサーション

- `.js`ファイル内でTypeScriptの型アサーション構文（`as Type`）を使用することは禁止します。型アサーションはTypeScriptファイル（`.ts`または`.tsx`）でのみ使用可能です。

## 4. `as any` キャストの禁止

- 原則として`as any`キャストの使用は禁止します。`as any`キャストが必要になる場合は、型安全性が損なわれている可能性が高いため、設計や型の定義を見直してください。

## 5. リファクタリング方針

- **ドキュメンテーションの充実**: TypeDocコメントを詳細に記述し、クラス、メソッド、プロパティの役割、引数、戻り値、注意点などを明確にする。
- タスクのコンテキストやIssue、ブランチの詳細に実装の意図が書かれている場合、それをドキュメントに反映する。
- TypeDocは型情報をコードから抽出するため関数ドキュメント`@param`の型情報や変数ドキュメントの`@type`は不要です。
- **リソース管理と破棄処理**: PixiJSのレンダラーやThree.jsのテクスチャなど、生成したリソースは適切に管理し、不要になった際には明示的に破棄する仕組みを実装する。インスタンスの破棄状態を管理するフラグやゲッターを導入し、二重解放などを防ぐ。
- **循環参照の回避**: クラス間で循環参照が発生する場合は、インターフェイスを定義し、依存関係の方向を一方通行にすることで回避してください。
