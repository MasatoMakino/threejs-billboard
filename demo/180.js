(self.webpackChunk_masatomakino_threejs_billboard=self.webpackChunk_masatomakino_threejs_billboard||[]).push([[180],{7403:t=>{t.exports=function(t){var n=[];return t.replace(r,(function(t,r,s){var a=r.toLowerCase();for(s=function(t){var e=t.match(i);return e?e.map(Number):[]}(s),"m"==a&&s.length>2&&(n.push([r].concat(s.splice(0,2))),a="l",r="m"==r?"l":"L");;){if(s.length==e[a])return s.unshift(r),n.push(s);if(s.length<e[a])throw new Error("malformed path data");n.push([r].concat(s.splice(0,e[a])))}})),n};var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},r=/([astvzqmhlc])([^astvzqmhlc]*)/gi,i=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi},4732:(t,e,r)=>{"use strict";var i=r(8507);class n{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this._cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:i}=this._resizeTo;t=r,e=i}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}n.extension=i.Ag.Application;var s=r(4458),a=r(7309);class o{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,s.d.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?a.R.shared:new a.R,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}o.extension=i.Ag.Application,i.XO.add(n),i.XO.add(o)},4980:(t,e,r)=>{"use strict";var i=r(8507);class n{constructor(t){this._renderer=t}push(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:e,filterEffect:t})}pop(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(t){"pushFilter"===t.action?this._renderer.filter.push(t):"popFilter"===t.action&&this._renderer.filter.pop()}destroy(){this._renderer=null}}n.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"filter"};var s=r(9313),a=r(3513),o=r(6011),l=r(5811),h=r(4492),u=r(2437),c=r(5099),d=r(9636),p=r(268);const f=new o.V({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:8,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class g{constructor(){this.skip=!1,this.inputTexture=null,this.backTexture=null,this.filters=null,this.bounds=new d.c,this.container=null,this.blendRequired=!1,this.outputRenderSurface=null,this.outputOffset={x:0,y:0},this.globalFrame={x:0,y:0,width:0,height:0}}}class x{constructor(t){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new l.k({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new a.T({}),this.renderer=t}get activeBackTexture(){return this._activeFilterData?.backTexture}push(t){const e=this.renderer,r=t.filterEffect.filters,i=this._pushFilterData();i.skip=!1,i.filters=r,i.container=t.container,i.outputRenderSurface=e.renderTarget.renderSurface;const n=e.renderTarget.renderTarget.colorTexture.source,s=n.resolution,a=n.antialias;if(0===r.length)return void(i.skip=!0);const o=i.bounds;if(t.renderables?function(t,e){e.clear();const r=e.matrix;for(let r=0;r<t.length;r++){const i=t[r];i.globalDisplayStatus<7||(e.matrix=i.worldTransform,e.addBounds(i.bounds))}e.matrix=r}(t.renderables,o):t.filterEffect.filterArea?(o.clear(),o.addRect(t.filterEffect.filterArea),o.applyMatrix(t.container.worldTransform)):t.container.getFastGlobalBounds(!0,o),t.container){const e=(t.container.renderGroup||t.container.parentRenderGroup).cacheToLocalTransform;e&&o.applyMatrix(e)}if(this._calculateFilterBounds(i,e.renderTarget.rootViewPort,a,s,1),i.skip)return;const l=this._getPreviousFilterData();let c=s,d=0,p=0;l&&(d=l.bounds.minX,p=l.bounds.minY,c=l.inputTexture.source._resolution),i.outputOffset.x=o.minX-d,i.outputOffset.y=o.minY-p;const f=i.globalFrame;if(f.x=d*c,f.y=p*c,f.width=n.width*c,f.height=n.height*c,i.backTexture=h.g.EMPTY,i.blendRequired){e.renderTarget.finishRenderPass();const t=e.renderTarget.getRenderTarget(i.outputRenderSurface);i.backTexture=this.getBackTexture(t,o,l?.bounds)}i.inputTexture=u.W.getOptimalTexture(o.width,o.height,i.resolution,i.antialias),e.renderTarget.bind(i.inputTexture,!0),e.globalUniforms.push({offset:o})}generateFilteredTexture({texture:t,filters:e}){const r=this._pushFilterData();this._activeFilterData=r,r.skip=!1,r.filters=e;const i=t.source,n=i.resolution,s=i.antialias;if(0===e.length)return r.skip=!0,t;const a=r.bounds;if(a.addRect(t.frame),this._calculateFilterBounds(r,a.rectangle,s,n,0),r.skip)return t;const o=n;r.outputOffset.x=-a.minX,r.outputOffset.y=-a.minY;const l=r.globalFrame;l.x=0*o,l.y=0*o,l.width=i.width*o,l.height=i.height*o,r.outputRenderSurface=u.W.getOptimalTexture(a.width,a.height,r.resolution,r.antialias),r.backTexture=h.g.EMPTY,r.inputTexture=t,this.renderer.renderTarget.finishRenderPass(),this._applyFiltersToTexture(r,!0);const c=r.outputRenderSurface;return c.source.alphaMode="premultiplied-alpha",c}pop(){const t=this.renderer,e=this._popFilterData();e.skip||(t.globalUniforms.pop(),t.renderTarget.finishRenderPass(),this._activeFilterData=e,this._applyFiltersToTexture(e,!1),e.blendRequired&&u.W.returnTexture(e.backTexture),u.W.returnTexture(e.inputTexture))}getBackTexture(t,e,r){const i=t.colorTexture.source._resolution,n=u.W.getOptimalTexture(e.width,e.height,i,!1);let s=e.minX,a=e.minY;r&&(s-=r.minX,a-=r.minY),s=Math.floor(s*i),a=Math.floor(a*i);const o=Math.ceil(e.width*i),l=Math.ceil(e.height*i);return this.renderer.renderTarget.copyToTexture(t,n,{x:s,y:a},{width:o,height:l},{x:0,y:0}),n}applyFilter(t,e,r,i){const n=this.renderer,s=this._activeFilterData,a=s.outputRenderSurface,o=this._filterGlobalUniforms,l=o.uniforms,u=l.uOutputFrame,d=l.uInputSize,p=l.uInputPixel,g=l.uInputClamp,x=l.uGlobalFrame,m=l.uOutputTexture;a===r?(u[0]=s.outputOffset.x,u[1]=s.outputOffset.y):(u[0]=0,u[1]=0),u[2]=e.frame.width,u[3]=e.frame.height,d[0]=e.source.width,d[1]=e.source.height,d[2]=1/d[0],d[3]=1/d[1],p[0]=e.source.pixelWidth,p[1]=e.source.pixelHeight,p[2]=1/p[0],p[3]=1/p[1],g[0]=.5*p[2],g[1]=.5*p[3],g[2]=e.frame.width*d[2]-.5*p[2],g[3]=e.frame.height*d[3]-.5*p[3],x[0]=s.globalFrame.x,x[1]=s.globalFrame.y,x[2]=s.globalFrame.width,x[3]=s.globalFrame.height,r instanceof h.g&&(r.source.resource=null);const y=this.renderer.renderTarget.getRenderTarget(r);if(n.renderTarget.bind(r,!!i),r instanceof h.g?(m[0]=r.frame.width,m[1]=r.frame.height):(m[0]=y.width,m[1]=y.height),m[2]=y.isRoot?-1:1,o.update(),n.renderPipes.uniformBatch){const t=n.renderPipes.uniformBatch.getUboResource(o);this._globalFilterBindGroup.setResource(t,0)}else this._globalFilterBindGroup.setResource(o,0);this._globalFilterBindGroup.setResource(e.source,1),this._globalFilterBindGroup.setResource(e.source.style,2),t.groups[0]=this._globalFilterBindGroup,n.encoder.draw({geometry:f,shader:t,state:t._state,topology:"triangle-list"}),n.type===c.W.WEBGL&&n.renderTarget.finishRenderPass()}calculateSpriteMatrix(t,e){const r=this._activeFilterData,i=t.set(r.inputTexture._source.width,0,0,r.inputTexture._source.height,r.bounds.minX,r.bounds.minY),n=e.worldTransform.copyTo(s.u.shared),a=e.renderGroup||e.parentRenderGroup;return a&&a.cacheToLocalTransform&&n.prepend(a.cacheToLocalTransform),n.invert(),i.prepend(n),i.scale(1/e.texture.frame.width,1/e.texture.frame.height),i.translate(e.anchor.x,e.anchor.y),i}destroy(){}_applyFiltersToTexture(t,e){const r=t.inputTexture,i=t.bounds,n=t.filters;if(this._globalFilterBindGroup.setResource(r.source.style,2),this._globalFilterBindGroup.setResource(t.backTexture.source,3),1===n.length)n[0].apply(this,r,t.outputRenderSurface,e);else{let r=t.inputTexture;const s=u.W.getOptimalTexture(i.width,i.height,r.source._resolution,!1);let a=s,o=0;for(o=0;o<n.length-1;++o){n[o].apply(this,r,a,!0);const t=r;r=a,a=t}n[o].apply(this,r,t.outputRenderSurface,e),u.W.returnTexture(s)}}_calculateFilterBounds(t,e,r,i,n){const s=this.renderer,a=t.bounds,o=t.filters;let l=1/0,h=0,u=!0,c=!1,d=!1,f=!0;for(let t=0;t<o.length;t++){const e=o[t];if(l=Math.min(l,"inherit"===e.resolution?i:e.resolution),h+=e.padding,"off"===e.antialias?u=!1:"inherit"===e.antialias&&u&&(u=r),e.clipToViewport||(f=!1),!(e.compatibleRenderers&s.type)){d=!1;break}if(e.blendRequired&&!(s.backBuffer?.useBackBuffer??1)){(0,p.R)("Blend filter requires backBuffer on WebGL renderer to be enabled. Set `useBackBuffer: true` in the renderer options."),d=!1;break}d=e.enabled||d,c||(c=e.blendRequired)}d?(f&&a.fitBounds(0,e.width/i,0,e.height/i),a.scale(l).ceil().scale(1/l).pad((0|h)*n),a.isPositive?(t.antialias=u,t.resolution=l,t.blendRequired=c):t.skip=!0):t.skip=!0}_popFilterData(){return this._filterStackIndex--,this._filterStack[this._filterStackIndex]}_getPreviousFilterData(){let t,e=this._filterStackIndex-1;for(;e>1&&(e--,t=this._filterStack[e],t.skip););return t}_pushFilterData(){let t=this._filterStack[this._filterStackIndex];return t||(t=this._filterStack[this._filterStackIndex]=new g),this._filterStackIndex++,t}}x.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem],name:"filter"},i.XO.add(x),i.XO.add(n)},341:(t,e,r)=>{"use strict";r.d(e,{w:()=>a});var i=r(3513),n=r(4492);const s={};function a(t,e,r){let a=2166136261;for(let r=0;r<e;r++)a^=t[r].uid,a=Math.imul(a,16777619),a>>>=0;return s[a]||function(t,e,r,a){const o={};let l=0;for(let r=0;r<a;r++){const i=r<e?t[r]:n.g.EMPTY.source;o[l++]=i.source,o[l++]=i.style}const h=new i.T(o);return s[r]=h,h}(t,e,a,r)}},7608:(t,e,r)=>{"use strict";r.d(e,{N:()=>s});var i=r(1761),n=r(9939);const s=new class{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const r=i.e.get().createCanvas();r.width=t,r.height=e;const n=r.getContext("2d");return{canvas:r,context:n}}getOptimalCanvasAndContext(t,e,r=1){t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6);const i=((t=(0,n.U5)(t))<<17)+((e=(0,n.U5)(e))<<1);this._canvasPool[i]||(this._canvasPool[i]=[]);let s=this._canvasPool[i].pop();return s||(s=this._createCanvasAndContext(t,e)),s}returnCanvasAndContext(t){const e=t.canvas,{width:r,height:i}=e,n=(r<<17)+(i<<1);t.context.clearRect(0,0,r,i),this._canvasPool[n].push(t)}clear(){this._canvasPool={}}}},8928:(t,e,r)=>{"use strict";var i=r(8507),n=r(6101),s=r(7547),a=r(8218),o=r(2760),l=r(6954);class h{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach((t=>{a.Z.return(t)})),this.batches.length=0}}class u{constructor(t,e){this.state=s.U.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this)}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){const e=t.context,r=!!t._gpuData,i=this.renderer.graphicsContext.updateGpuContext(e);return!(!i.isBatchable&&r===i.isBatchable)}addRenderable(t,e){const r=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),r.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){const e=this._getGpuDataForRenderable(t).batches;for(let t=0;t<e.length;t++){const r=e[t];r._batcher.updateElement(r)}}execute(t){if(!t.isRenderable)return;const e=this.renderer,r=t.context;if(!e.graphicsContext.getGpuContext(r).batches.length)return;const i=r.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;const n=i.resources.localUniforms.uniforms;n.uTransformMatrix=t.groupTransform,n.uRound=e._roundPixels|t._roundPixels,(0,o.V)(t.groupColorAlpha,n.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){const e=this._getGpuDataForRenderable(t),r=this.renderer.graphicsContext.updateGpuContext(t.context);e.destroy(),r.isBatchable&&this._updateBatchesForRenderable(t,e)}_addToBatcher(t,e){const r=this.renderer.renderPipes.batch,i=this._getGpuDataForRenderable(t).batches;for(let t=0;t<i.length;t++){const n=i[t];r.addToBatch(n,e)}}_getGpuDataForRenderable(t){return t._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(t)}_initGpuDataForRenderable(t){const e=new h;return t._gpuData[this.renderer.uid]=e,e}_updateBatchesForRenderable(t,e){const r=t.context,i=this.renderer.graphicsContext.getGpuContext(r),n=this.renderer._roundPixels|t._roundPixels;e.batches=i.batches.map((e=>{const r=a.Z.get(l.G);return e.copyTo(r),r.renderable=t,r.roundPixels=n,r}))}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}u.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"graphics"},i.XO.add(u),i.XO.add(n.GH)},6954:(t,e,r)=>{"use strict";r.d(e,{G:()=>a});var i=r(9313),n=r(4676);const s=new i.u;class a{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|65280&t|(255&t)<<16,r=this.renderable;return r?(0,n.u)(e,r.groupColor)+(this.alpha*r.groupAlpha*255<<24):e+(255*this.alpha<<24)}get transform(){return this.renderable?.groupTransform||s}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}},9408:(t,e,r)=>{"use strict";r.d(e,{A:()=>a});var i=r(4670),n=r(4985),s=r(5997);class a extends n.l{constructor(t){t instanceof s.T&&(t={context:t});const{context:e,roundPixels:r,...i}=t||{};super({label:"Graphics",...i}),this.renderPipeId="graphics",this._context=e||(this._ownedContext=new s.T),this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=r??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):!0!==t&&!0!==t?.context||this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new a(this._context.clone()):(this._ownedContext=null,new a(this._context))}lineStyle(t,e,r){(0,i.t6)(i.lj,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const n={};return t&&(n.width=t),e&&(n.color=e),r&&(n.alpha=r),this.context.strokeStyle=n,this}beginFill(t,e){(0,i.t6)(i.lj,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const r={};return void 0!==t&&(r.color=t),void 0!==e&&(r.alpha=e),this.context.fillStyle=r,this}endFill(){(0,i.t6)(i.lj,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return t.width===s.T.defaultStrokeStyle.width&&t.color===s.T.defaultStrokeStyle.color&&t.alpha===s.T.defaultStrokeStyle.alpha||this.context.stroke(),this}drawCircle(...t){return(0,i.t6)(i.lj,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return(0,i.t6)(i.lj,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return(0,i.t6)(i.lj,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return(0,i.t6)(i.lj,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return(0,i.t6)(i.lj,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return(0,i.t6)(i.lj,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}},5997:(t,e,r)=>{"use strict";r.d(e,{T:()=>it});var i=r(8875),n=r(2577),s=r(9313),a=r(5101),o=r(4492),l=r(133),h=r(4670),u=r(9636),c=r(268),d=r(7403),p=r(9252);class f{constructor(t=0,e=0,r=0){this.type="circle",this.x=t,this.y=e,this.radius=r}clone(){return new f(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let i=this.x-t,n=this.y-e;return i*=i,n*=n,i+n<=r}strokeContains(t,e,r,i=.5){if(0===this.radius)return!1;const n=this.x-t,s=this.y-e,a=this.radius,o=(1-i)*r,l=Math.sqrt(n*n+s*s);return l<=a+o&&l>a-(r-o)}getBounds(t){return t||(t=new p.M),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=2*this.radius,t.height=2*this.radius,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class g{constructor(t=0,e=0,r=0,i=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=r,this.halfHeight=i}clone(){return new g(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let r=(t-this.x)/this.halfWidth,i=(e-this.y)/this.halfHeight;return r*=r,i*=i,r+i<=1}strokeContains(t,e,r,i=.5){const{halfWidth:n,halfHeight:s}=this;if(n<=0||s<=0)return!1;const a=r*(1-i),o=r-a,l=n-o,h=s-o,u=n+a,c=s+a,d=t-this.x,p=e-this.y;return d*d/(l*l)+p*p/(h*h)>1&&d*d/(u*u)+p*p/(c*c)<=1}getBounds(t){return t||(t=new p.M),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=2*this.halfWidth,t.height=2*this.halfHeight,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function x(t,e,r,i,n,s){const a=n-r,o=s-i,l=a*a+o*o;let h,u,c=-1;0!==l&&(c=((t-r)*a+(e-i)*o)/l),c<0?(h=r,u=i):c>1?(h=n,u=s):(h=r+c*a,u=i+c*o);const d=t-h,p=e-u;return d*d+p*p}class m{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let r=0,i=e.length;r<i;r++)t.push(e[r].x,e[r].y);e=t}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,r=e.length;for(let i=0;i<r;i+=2){const n=e[i],s=e[i+1];t+=(e[(i+2)%r]-n)*(e[(i+3)%r]+s)}return t<0}containsPolygon(t){const e=this.getBounds(void 0),r=t.getBounds(void 0);if(!e.containsRect(r))return!1;const i=t.points;for(let t=0;t<i.length;t+=2){const e=i[t],r=i[t+1];if(!this.contains(e,r))return!1}return!0}clone(){const t=this.points.slice(),e=new m(t);return e.closePath=this.closePath,e}contains(t,e){let r=!1;const i=this.points.length/2;for(let n=0,s=i-1;n<i;s=n++){const i=this.points[2*n],a=this.points[2*n+1],o=this.points[2*s],l=this.points[2*s+1];a>e!=l>e&&t<(e-a)/(l-a)*(o-i)+i&&(r=!r)}return r}strokeContains(t,e,r,i=.5){const n=r*r,s=n*(1-i),a=n-s,{points:o}=this,l=o.length-(this.closePath?0:2);for(let r=0;r<l;r+=2){const i=o[r],n=o[r+1],l=o[(r+2)%o.length],h=o[(r+3)%o.length];if(x(t,e,i,n,l,h)<=(Math.sign((l-i)*(e-n)-(h-n)*(t-i))<0?a:s))return!0}return!1}getBounds(t){t||(t=new p.M);const e=this.points;let r=1/0,i=-1/0,n=1/0,s=-1/0;for(let t=0,a=e.length;t<a;t+=2){const a=e[t],o=e[t+1];r=a<r?a:r,i=a>i?a:i,n=o<n?o:n,s=o>s?o:s}return t.x=r,t.width=i-r,t.y=n,t.height=s-n,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}const y=(t,e,r,i,n,s,a)=>{const o=t-r,l=e-i,h=Math.sqrt(o*o+l*l);return h>=n-s&&h<=n+a};class _{constructor(t=0,e=0,r=0,i=0,n=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=r,this.height=i,this.radius=n}getBounds(t){return t||(t=new p.M),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new _(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let i=t-(this.x+r),n=e-(this.y+r);const s=r*r;if(i*i+n*n<=s)return!0;if(i=t-(this.x+this.width-r),i*i+n*n<=s)return!0;if(n=e-(this.y+this.height-r),i*i+n*n<=s)return!0;if(i=t-(this.x+r),i*i+n*n<=s)return!0}return!1}strokeContains(t,e,r,i=.5){const{x:n,y:s,width:a,height:o,radius:l}=this,h=r*(1-i),u=r-h,c=n+l,d=s+l,p=n+a,f=s+o;return(t>=n-h&&t<=n+u||t>=p-u&&t<=p+h)&&e>=d&&e<=d+(o-2*l)||(e>=s-h&&e<=s+u||e>=f-u&&e<=f+h)&&t>=c&&t<=c+(a-2*l)||t<c&&e<d&&y(t,e,c,d,l,u,h)||t>p-l&&e<d&&y(t,e,p-l,d,l,u,h)||t>p-l&&e>f-l&&y(t,e,p-l,f-l,l,u,h)||t<c&&e>f-l&&y(t,e,c,f-l,l,u,h)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}var b=r(6101);const v=8,S=1.1920929e-7,w=1,T=.01,M=0,P=0;function C(t,e,r,i,n,s,a,o,l,h){const u=Math.min(.99,Math.max(0,h??b.GH.defaultOptions.bezierSmoothness));let c=(w-u)/1;return c*=c,function(t,e,r,i,n,s,a,o,l,h){k(t,e,r,i,n,s,a,o,l,h,0),l.push(a,o)}(e,r,i,n,s,a,o,l,t,c),t}function k(t,e,r,i,n,s,a,o,l,h,u){if(u>v)return;const c=Math.PI,d=(t+r)/2,p=(e+i)/2,f=(r+n)/2,g=(i+s)/2,x=(n+a)/2,m=(s+o)/2,y=(d+f)/2,_=(p+g)/2,b=(f+x)/2,w=(g+m)/2,C=(y+b)/2,F=(_+w)/2;if(u>0){let u=a-t,d=o-e;const p=Math.abs((r-a)*d-(i-o)*u),f=Math.abs((n-a)*d-(s-o)*u);let g,x;if(p>S&&f>S){if((p+f)*(p+f)<=h*(u*u+d*d)){if(M<T)return void l.push(C,F);const h=Math.atan2(s-i,n-r);if(g=Math.abs(h-Math.atan2(i-e,r-t)),x=Math.abs(Math.atan2(o-s,a-n)-h),g>=c&&(g=2*c-g),x>=c&&(x=2*c-x),g+x<M)return void l.push(C,F);if(0!==P){if(g>P)return void l.push(r,i);if(x>P)return void l.push(n,s)}}}else if(p>S){if(p*p<=h*(u*u+d*d)){if(M<T)return void l.push(C,F);if(g=Math.abs(Math.atan2(s-i,n-r)-Math.atan2(i-e,r-t)),g>=c&&(g=2*c-g),g<M)return l.push(r,i),void l.push(n,s);if(0!==P&&g>P)return void l.push(r,i)}}else if(f>S){if(f*f<=h*(u*u+d*d)){if(M<T)return void l.push(C,F);if(g=Math.abs(Math.atan2(o-s,a-n)-Math.atan2(s-i,n-r)),g>=c&&(g=2*c-g),g<M)return l.push(r,i),void l.push(n,s);if(0!==P&&g>P)return void l.push(n,s)}}else if(u=C-(t+a)/2,d=F-(e+o)/2,u*u+d*d<=h)return void l.push(C,F)}k(t,e,d,p,y,_,C,F,l,h,u+1),k(C,F,b,w,x,m,a,o,l,h,u+1)}const F=8,R=1.1920929e-7,A=.01,B=0;function z(t,e,r,i,n,s,a,o){let l=(1-Math.min(.99,Math.max(0,o??b.GH.defaultOptions.bezierSmoothness)))/1;return l*=l,function(t,e,r,i,n,s,a,o){U(a,t,e,r,i,n,s,o,0),a.push(n,s)}(e,r,i,n,s,a,t,l),t}function U(t,e,r,i,n,s,a,o,l){if(l>F)return;const h=Math.PI,u=(e+i)/2,c=(r+n)/2,d=(i+s)/2,p=(n+a)/2,f=(u+d)/2,g=(c+p)/2;let x=s-e,m=a-r;const y=Math.abs((i-s)*m-(n-a)*x);if(y>R){if(y*y<=o*(x*x+m*m)){if(B<A)return void t.push(f,g);let o=Math.abs(Math.atan2(a-n,s-i)-Math.atan2(n-r,i-e));if(o>=h&&(o=2*h-o),o<B)return void t.push(f,g)}}else if(x=f-(e+s)/2,m=g-(r+a)/2,x*x+m*m<=o)return void t.push(f,g);U(t,e,r,u,c,f,g,o,l+1),U(t,f,g,d,p,s,a,o,l+1)}function W(t,e,r,i,n,s,a,o){let l=Math.abs(n-s);(!a&&n>s||a&&s>n)&&(l=2*Math.PI-l),o||(o=Math.max(6,Math.floor(6*Math.pow(i,1/3)*(l/Math.PI))));let h=l/(o=Math.max(o,3)),u=n;h*=a?-1:1;for(let n=0;n<o+1;n++){const n=e+Math.cos(u)*i,s=r+Math.sin(u)*i;t.push(n,s),u+=h}}const G=2*Math.PI,D={centerX:0,centerY:0,ang1:0,ang2:0},O=({x:t,y:e},r,i,n,s,a,o,l)=>{const h=n*(t*=r)-s*(e*=i),u=s*t+n*e;return l.x=h+a,l.y=u+o,l};function L(t,e){const r=-1.5707963267948966===e?-.551915024494:4/3*Math.tan(e/4),i=1.5707963267948966===e?.551915024494:r,n=Math.cos(t),s=Math.sin(t),a=Math.cos(t+e),o=Math.sin(t+e);return[{x:n-s*i,y:s+n*i},{x:a+o*i,y:o-a*i},{x:a,y:o}]}const I=(t,e,r,i)=>{let n=t*r+e*i;return n>1&&(n=1),n<-1&&(n=-1),(t*i-e*r<0?-1:1)*Math.acos(n)};const V=new p.M;class H{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new u.c,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const r=this._currentPoly.points,i=r[r.length-2],n=r[r.length-1];return i===t&&n===e||r.push(t,e),this}arc(t,e,r,i,n,s){return this._ensurePoly(!1),W(this._currentPoly.points,t,e,r,i,n,s),this}arcTo(t,e,r,i,n){return this._ensurePoly(),function(t,e,r,i,n,s){const a=t[t.length-2],o=t[t.length-1]-r,l=a-e,h=n-r,u=i-e,c=Math.abs(o*u-l*h);if(c<1e-8||0===s)return void(t[t.length-2]===e&&t[t.length-1]===r||t.push(e,r));const d=o*o+l*l,p=h*h+u*u,f=o*h+l*u,g=s*Math.sqrt(d)/c,x=s*Math.sqrt(p)/c,m=g*f/d,y=x*f/p,_=g*u+x*l,b=g*h+x*o,v=l*(x+m),S=o*(x+m),w=u*(g+y),T=h*(g+y);W(t,_+e,b+r,s,Math.atan2(S-b,v-_),Math.atan2(T-b,w-_),l*h>u*o)}(this._currentPoly.points,t,e,r,i,n),this}arcToSvg(t,e,r,i,n,s,a){return function(t,e,r,i,n,s,a,o=0,l=0,h=0){if(0===s||0===a)return;const u=Math.sin(o*G/360),c=Math.cos(o*G/360),d=c*(e-i)/2+u*(r-n)/2,p=-u*(e-i)/2+c*(r-n)/2;if(0===d&&0===p)return;s=Math.abs(s),a=Math.abs(a);const f=Math.pow(d,2)/Math.pow(s,2)+Math.pow(p,2)/Math.pow(a,2);f>1&&(s*=Math.sqrt(f),a*=Math.sqrt(f)),((t,e,r,i,n,s,a,o,l,h,u,c,d)=>{const p=Math.pow(n,2),f=Math.pow(s,2),g=Math.pow(u,2),x=Math.pow(c,2);let m=p*f-p*x-f*g;m<0&&(m=0),m/=p*x+f*g,m=Math.sqrt(m)*(a===o?-1:1);const y=m*n/s*c,_=m*-s/n*u,b=h*y-l*_+(t+r)/2,v=l*y+h*_+(e+i)/2,S=(u-y)/n,w=(c-_)/s,T=(-u-y)/n,M=(-c-_)/s,P=I(1,0,S,w);let C=I(S,w,T,M);0===o&&C>0&&(C-=G),1===o&&C<0&&(C+=G),d.centerX=b,d.centerY=v,d.ang1=P,d.ang2=C})(e,r,i,n,s,a,l,h,u,c,d,p,D);let{ang1:g,ang2:x}=D;const{centerX:m,centerY:y}=D;let _=Math.abs(x)/(G/4);Math.abs(1-_)<1e-7&&(_=1);const b=Math.max(Math.ceil(_),1);x/=b;let v=t[t.length-2],S=t[t.length-1];const w={x:0,y:0};for(let e=0;e<b;e++){const e=L(g,x),{x:r,y:i}=O(e[0],s,a,c,u,m,y,w),{x:n,y:o}=O(e[1],s,a,c,u,m,y,w),{x:l,y:h}=O(e[2],s,a,c,u,m,y,w);C(t,v,S,r,i,n,o,l,h),v=l,S=h,g+=x}}(this._currentPoly.points,this._currentPoly.lastX,this._currentPoly.lastY,s,a,t,e,r,i,n),this}bezierCurveTo(t,e,r,i,n,s,a){this._ensurePoly();const o=this._currentPoly;return C(this._currentPoly.points,o.lastX,o.lastY,t,e,r,i,n,s,a),this}quadraticCurveTo(t,e,r,i,n){this._ensurePoly();const s=this._currentPoly;return z(this._currentPoly.points,s.lastX,s.lastY,t,e,r,i,n),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0)).transform(e);const r=this.shapePrimitives,i=r.length;for(let e=0;e<t.instructions.length;e++){const r=t.instructions[e];this[r.action](...r.data)}if(t.checkForHoles&&r.length-i>1){let t=null;for(let e=i;e<r.length;e++){const i=r[e];if("polygon"===i.shape.type){const n=i.shape,s=t?.shape;s&&s.containsPolygon(n)?(t.holes||(t.holes=[]),t.holes.push(i),r.copyWithin(e,e+1),r.length--,e--):t=i}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,r,i,n){return this.drawShape(new p.M(t,e,r,i),n),this}circle(t,e,r,i){return this.drawShape(new f(t,e,r),i),this}poly(t,e,r){const i=new m(t);return i.closePath=e,this.drawShape(i,r),this}regularPoly(t,e,r,i,n=0,s){i=Math.max(0|i,3);const a=-1*Math.PI/2+n,o=2*Math.PI/i,l=[];for(let n=0;n<i;n++){const i=a-n*o;l.push(t+r*Math.cos(i),e+r*Math.sin(i))}return this.poly(l,!0,s),this}roundPoly(t,e,r,i,n,s=0,a){if(i=Math.max(0|i,3),n<=0)return this.regularPoly(t,e,r,i,s);const o=r*Math.sin(Math.PI/i)-.001;n=Math.min(n,o);const l=-1*Math.PI/2+s,h=2*Math.PI/i,u=(i-2)*Math.PI/i/2;for(let s=0;s<i;s++){const i=s*h+l,o=t+r*Math.cos(i),c=e+r*Math.sin(i),d=i+Math.PI+u,p=i-Math.PI-u,f=o+n*Math.cos(d),g=c+n*Math.sin(d),x=o+n*Math.cos(p),m=c+n*Math.sin(p);0===s?this.moveTo(f,g):this.lineTo(f,g),this.quadraticCurveTo(o,c,x,m,a)}return this.closePath()}roundShape(t,e,r=!1,i){return t.length<3?this:(r?function(t,e,r,i){const n=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),s=(t,e,r)=>({x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}),a=e.length;for(let o=0;o<a;o++){const l=e[(o+1)%a],h=l.radius??r;if(h<=0){0===o?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y);continue}const u=e[o],c=e[(o+2)%a],d=n(u,l);let p;p=d<1e-4?l:s(l,u,Math.min(d/2,h)/d);const f=n(c,l);let g;g=f<1e-4?l:s(l,c,Math.min(f/2,h)/f),0===o?t.moveTo(p.x,p.y):t.lineTo(p.x,p.y),t.quadraticCurveTo(l.x,l.y,g.x,g.y,i)}}(this,t,e,i):function(t,e,r){const i=(t,e)=>{const r=e.x-t.x,i=e.y-t.y,n=Math.sqrt(r*r+i*i);return{len:n,nx:r/n,ny:i/n}},n=(e,r)=>{0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y)};let s=e[e.length-1];for(let a=0;a<e.length;a++){const o=e[a%e.length],l=o.radius??r;if(l<=0){n(a,o),s=o;continue}const h=e[(a+1)%e.length],u=i(o,s),c=i(o,h);if(u.len<1e-4||c.len<1e-4){n(a,o),s=o;continue}let d=Math.asin(u.nx*c.ny-u.ny*c.nx),p=1,f=!1;u.nx*c.nx-u.ny*-c.ny<0?d<0?d=Math.PI+d:(d=Math.PI-d,p=-1,f=!0):d>0&&(p=-1,f=!0);const g=d/2;let x,m=Math.abs(Math.cos(g)*l/Math.sin(g));m>Math.min(u.len/2,c.len/2)?(m=Math.min(u.len/2,c.len/2),x=Math.abs(m*Math.sin(g)/Math.cos(g))):x=l;const y=o.x+c.nx*m+-c.ny*x*p,_=o.y+c.ny*m+c.nx*x*p,b=Math.atan2(u.ny,u.nx)+Math.PI/2*p,v=Math.atan2(c.ny,c.nx)-Math.PI/2*p;0===a&&t.moveTo(y+Math.cos(b)*x,_+Math.sin(b)*x),t.arc(y,_,x,b,v,f),s=o}}(this,t,e),this.closePath())}filletRect(t,e,r,i,n){if(0===n)return this.rect(t,e,r,i);const s=Math.min(r,i)/2,a=Math.min(s,Math.max(-s,n)),o=t+r,l=e+i,h=a<0?-a:0,u=Math.abs(a);return this.moveTo(t,e+u).arcTo(t+h,e+h,t+u,e,u).lineTo(o-u,e).arcTo(o-h,e+h,o,e+u,u).lineTo(o,l-u).arcTo(o-h,l-h,t+r-u,l,u).lineTo(t+u,l).arcTo(t+h,l-h,t,l-u,u).closePath()}chamferRect(t,e,r,i,n,s){if(n<=0)return this.rect(t,e,r,i);const a=Math.min(n,Math.min(r,i)/2),o=t+r,l=e+i,h=[t+a,e,o-a,e,o,e+a,o,l-a,o-a,l,t+a,l,t,l-a,t,e+a];for(let t=h.length-1;t>=2;t-=2)h[t]===h[t-2]&&h[t-1]===h[t-3]&&h.splice(t-1,2);return this.poly(h,!0,s)}ellipse(t,e,r,i,n){return this.drawShape(new g(t,e,r,i),n),this}roundRect(t,e,r,i,n,s){return this.drawShape(new _(t,e,r,i,n),s),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let r=this._currentPoly;return r&&this.endPoly(),r=new m,r.points.push(t,e),this._currentPoly=r,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new m,t)){const t=this.shapePrimitives[this.shapePrimitives.length-1];if(t){let e=t.shape.x,r=t.shape.y;if(t.transform&&!t.transform.isIdentity()){const i=t.transform,n=e;e=i.a*e+i.c*r+i.tx,r=i.b*n+i.d*r+i.ty}this._currentPoly.points.push(e,r)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const r=t.instructions[e];this[r.action](...r.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let r=0;r<e.length;r++){const i=e[r],n=i.shape.getBounds(V);i.transform?t.addRect(n,i.transform):t.addRect(n)}return t}}class E{constructor(t,e=!1){this.instructions=[],this.uid=(0,l.L)("graphicsPath"),this._dirty=!0,this.checkForHoles=e,"string"==typeof t?function(t,e){const r=d(t),i=[];let n=null,s=0,a=0;for(let t=0;t<r.length;t++){const o=r[t],l=o[0],h=o;switch(l){case"M":s=h[1],a=h[2],e.moveTo(s,a);break;case"m":s+=h[1],a+=h[2],e.moveTo(s,a);break;case"H":s=h[1],e.lineTo(s,a);break;case"h":s+=h[1],e.lineTo(s,a);break;case"V":a=h[1],e.lineTo(s,a);break;case"v":a+=h[1],e.lineTo(s,a);break;case"L":s=h[1],a=h[2],e.lineTo(s,a);break;case"l":s+=h[1],a+=h[2],e.lineTo(s,a);break;case"C":s=h[5],a=h[6],e.bezierCurveTo(h[1],h[2],h[3],h[4],s,a);break;case"c":e.bezierCurveTo(s+h[1],a+h[2],s+h[3],a+h[4],s+h[5],a+h[6]),s+=h[5],a+=h[6];break;case"S":s=h[3],a=h[4],e.bezierCurveToShort(h[1],h[2],s,a);break;case"s":e.bezierCurveToShort(s+h[1],a+h[2],s+h[3],a+h[4]),s+=h[3],a+=h[4];break;case"Q":s=h[3],a=h[4],e.quadraticCurveTo(h[1],h[2],s,a);break;case"q":e.quadraticCurveTo(s+h[1],a+h[2],s+h[3],a+h[4]),s+=h[3],a+=h[4];break;case"T":s=h[1],a=h[2],e.quadraticCurveToShort(s,a);break;case"t":s+=h[1],a+=h[2],e.quadraticCurveToShort(s,a);break;case"A":s=h[6],a=h[7],e.arcToSvg(h[1],h[2],h[3],h[4],h[5],s,a);break;case"a":s+=h[6],a+=h[7],e.arcToSvg(h[1],h[2],h[3],h[4],h[5],s,a);break;case"Z":case"z":e.closePath(),i.length>0&&(n=i.pop(),n?(s=n.startX,a=n.startY):(s=0,a=0)),n=null;break;default:(0,c.R)(`Unknown SVG path command: ${l}`)}"Z"!==l&&"z"!==l&&null===n&&(n={startX:s,startY:a},i.push(n))}}(t,this):this.instructions=t?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new H(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,r,i,n){const s=this.instructions[this.instructions.length-1],o=this.getLastPoint(a.b.shared);let l=0,h=0;if(s&&"bezierCurveTo"===s.action){l=s.data[2],h=s.data[3];const t=o.x,e=o.y;l=t+(t-l),h=e+(e-h)}else l=o.x,h=o.y;return this.instructions.push({action:"bezierCurveTo",data:[l,h,t,e,r,i,n]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,r){const i=this.instructions[this.instructions.length-1],n=this.getLastPoint(a.b.shared);let s=0,o=0;if(i&&"quadraticCurveTo"===i.action){s=i.data[0],o=i.data[1];const t=n.x,e=n.y;s=t+(t-s),o=e+(e-o)}else s=n.x,o=n.y;return this.instructions.push({action:"quadraticCurveTo",data:[s,o,t,e,r]}),this._dirty=!0,this}rect(t,e,r,i,n){return this.instructions.push({action:"rect",data:[t,e,r,i,n]}),this._dirty=!0,this}circle(t,e,r,i){return this.instructions.push({action:"circle",data:[t,e,r,i]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,r,i,n,s,a){n||(n=i/2);const o=-1*Math.PI/2+s,l=2*r,h=2*Math.PI/l,u=[];for(let r=0;r<l;r++){const s=r%2?n:i,a=r*h+o;u.push(t+s*Math.cos(a),e+s*Math.sin(a))}return this.poly(u,!0,a),this}clone(t=!1){const e=new E;if(e.checkForHoles=this.checkForHoles,t)for(let t=0;t<this.instructions.length;t++){const r=this.instructions[t];e.instructions.push({action:r.action,data:r.data.slice()})}else e.instructions=this.instructions.slice();return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,r=t.b,i=t.c,n=t.d,s=t.tx,a=t.ty;let o=0,l=0,h=0,u=0,d=0,p=0,f=0,g=0;for(let x=0;x<this.instructions.length;x++){const m=this.instructions[x],y=m.data;switch(m.action){case"moveTo":case"lineTo":o=y[0],l=y[1],y[0]=e*o+i*l+s,y[1]=r*o+n*l+a;break;case"bezierCurveTo":h=y[0],u=y[1],d=y[2],p=y[3],o=y[4],l=y[5],y[0]=e*h+i*u+s,y[1]=r*h+n*u+a,y[2]=e*d+i*p+s,y[3]=r*d+n*p+a,y[4]=e*o+i*l+s,y[5]=r*o+n*l+a;break;case"quadraticCurveTo":h=y[0],u=y[1],o=y[2],l=y[3],y[0]=e*h+i*u+s,y[1]=r*h+n*u+a,y[2]=e*o+i*l+s,y[3]=r*o+n*l+a;break;case"arcToSvg":o=y[5],l=y[6],f=y[0],g=y[1],y[0]=e*f+i*g,y[1]=r*f+n*g,y[5]=e*o+i*l+s,y[6]=r*o+n*l+a;break;case"circle":y[4]=$(y[3],t);break;case"rect":y[4]=$(y[4],t);break;case"ellipse":y[8]=$(y[8],t);break;case"roundRect":y[5]=$(y[5],t);break;case"addPath":y[0].transform(t);break;case"poly":y[2]=$(y[2],t);break;default:(0,c.R)("unknown transform action",m.action)}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,r=this.instructions[e];if(!r)return t.x=0,t.y=0,t;for(;"closePath"===r.action;){if(e--,e<0)return t.x=0,t.y=0,t;r=this.instructions[e]}switch(r.action){case"moveTo":case"lineTo":t.x=r.data[0],t.y=r.data[1];break;case"quadraticCurveTo":t.x=r.data[2],t.y=r.data[3];break;case"bezierCurveTo":t.x=r.data[4],t.y=r.data[5];break;case"arc":case"arcToSvg":t.x=r.data[5],t.y=r.data[6];break;case"addPath":r.data[0].getLastPoint(t)}return t}}function $(t,e){return t?t.prepend(e):e.clone()}var j=r(7276);function X(t,e,r){const i=t.getAttribute(e);return i?Number(i):r}function q(t){const e=X(t,"x1",0),r=X(t,"y1",0),i=X(t,"x2",1),s=X(t,"y2",0),a=t.getAttribute("gradientUnits")||"objectBoundingBox",o=new j._(e,r,i,s,"objectBoundingBox"===a?"local":"global");for(let e=0;e<t.children.length;e++){const r=t.children[e],i=X(r,"offset",0),s=n.Q.shared.setValue(r.getAttribute("stop-color")).toNumber();o.addColorStop(i,s)}return o}function Y(t){const e=t.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return e?e[1]:""}const N={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function Z(t,e){const r=t.getAttribute("style"),i={},n={},s={strokeStyle:i,fillStyle:n,useFill:!1,useStroke:!1};for(const r in N){const i=t.getAttribute(r);i&&K(e,s,r,i.trim())}if(r){const t=r.split(";");for(let r=0;r<t.length;r++){const i=t[r].trim(),[n,a]=i.split(":");N[n]&&K(e,s,n,a.trim())}}return{strokeStyle:s.useStroke?i:null,fillStyle:s.useFill?n:null,useFill:s.useFill,useStroke:s.useStroke}}function K(t,e,r,i){switch(r){case"stroke":if("none"!==i){if(i.startsWith("url(")){const r=Y(i);e.strokeStyle.fill=t.defs[r]}else e.strokeStyle.color=n.Q.shared.setValue(i).toNumber();e.useStroke=!0}break;case"stroke-width":e.strokeStyle.width=Number(i);break;case"fill":if("none"!==i){if(i.startsWith("url(")){const r=Y(i);e.fillStyle.fill=t.defs[r]}else e.fillStyle.color=n.Q.shared.setValue(i).toNumber();e.useFill=!0}break;case"fill-opacity":e.fillStyle.alpha=Number(i);break;case"stroke-opacity":e.strokeStyle.alpha=Number(i);break;case"opacity":e.fillStyle.alpha=Number(i),e.strokeStyle.alpha=Number(i)}}function Q(t,e,r,i){const n=t.children,{fillStyle:s,strokeStyle:a}=Z(t,e);s&&r?r={...r,...s}:s&&(r=s),a&&i?i={...i,...a}:a&&(i=a);const o=!r&&!i;let l,h,u,d,p,f,g,x,m,y,_,b,v,S,w,T,M;switch(o&&(r={color:0}),t.nodeName.toLowerCase()){case"path":S=t.getAttribute("d"),"evenodd"===t.getAttribute("fill-rule")&&(0,c.R)("SVG Evenodd fill rule not supported, your svg may render incorrectly"),w=new E(S,!0),e.context.path(w),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"circle":g=X(t,"cx",0),x=X(t,"cy",0),m=X(t,"r",0),e.context.ellipse(g,x,m,m),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"rect":l=X(t,"x",0),h=X(t,"y",0),T=X(t,"width",0),M=X(t,"height",0),y=X(t,"rx",0),_=X(t,"ry",0),y||_?e.context.roundRect(l,h,T,M,y||_):e.context.rect(l,h,T,M),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"ellipse":g=X(t,"cx",0),x=X(t,"cy",0),y=X(t,"rx",0),_=X(t,"ry",0),e.context.beginPath(),e.context.ellipse(g,x,y,_),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"line":u=X(t,"x1",0),d=X(t,"y1",0),p=X(t,"x2",0),f=X(t,"y2",0),e.context.beginPath(),e.context.moveTo(u,d),e.context.lineTo(p,f),i&&e.context.stroke(i);break;case"polygon":v=t.getAttribute("points"),b=v.match(/\d+/g).map((t=>parseInt(t,10))),e.context.poly(b,!0),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"polyline":v=t.getAttribute("points"),b=v.match(/\d+/g).map((t=>parseInt(t,10))),e.context.poly(b,!1),i&&e.context.stroke(i);break;case"g":case"svg":break;default:(0,c.R)(`[SVG parser] <${t.nodeName}> elements unsupported`)}o&&(r=null);for(let t=0;t<n.length;t++)Q(n[t],e,r,i)}var J=r(990);const tt=new a.b,et=new s.u,rt=class t extends i.A{constructor(){super(...arguments),this.uid=(0,l.L)("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new E,this._transform=new s.u,this._fillStyle={...t.defaultFillStyle},this._strokeStyle={...t.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new u.c,this._boundsDirty=!0}clone(){const e=new t;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle={...this._fillStyle},e._strokeStyle={...this._strokeStyle},e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=(0,J.w)(e,t.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=(0,J.T)(e,t.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=(0,J.w)(e,t.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=(0,J.w)(e,t.defaultStrokeStyle),this}texture(t,e,r,i,s,a){return this.instructions.push({action:"texture",data:{image:t,dx:r||0,dy:i||0,dw:s||t.frame.width,dh:a||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?n.Q.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new E,this}fill(e,r){let i;const n=this.instructions[this.instructions.length-1];return i=0===this._tick&&n&&"stroke"===n.action?n.data.path:this._activePath.clone(),i?(null!=e&&(void 0!==r&&"number"==typeof e&&((0,h.t6)(h.lj,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),e={color:e,alpha:r}),this._fillStyle=(0,J.w)(e,t.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(a.b.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(e){let r;const i=this.instructions[this.instructions.length-1];return r=0===this._tick&&i&&"fill"===i.action?i.data.path:this._activePath.clone(),r?(null!=e&&(this._strokeStyle=(0,J.T)(e,t.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],r=this._activePath.clone();if(e&&("stroke"===e.action||"fill"===e.action)){if(!e.data.hole){e.data.hole=r;break}e.data.hole.addPath(r)}}return this._initNextPathLocation(),this}arc(t,e,r,i,n,s){this._tick++;const a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,r,i,n,s),this}arcTo(t,e,r,i,n){this._tick++;const s=this._transform;return this._activePath.arcTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty,s.a*r+s.c*i+s.tx,s.b*r+s.d*i+s.ty,n),this}arcToSvg(t,e,r,i,n,s,a){this._tick++;const o=this._transform;return this._activePath.arcToSvg(t,e,r,i,n,o.a*s+o.c*a+o.tx,o.b*s+o.d*a+o.ty),this}bezierCurveTo(t,e,r,i,n,s,a){this._tick++;const o=this._transform;return this._activePath.bezierCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*r+o.c*i+o.tx,o.b*r+o.d*i+o.ty,o.a*n+o.c*s+o.tx,o.b*n+o.d*s+o.ty,a),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,r,i){return this._tick++,this._activePath.ellipse(t,e,r,i,this._transform.clone()),this}circle(t,e,r){return this._tick++,this._activePath.circle(t,e,r,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const r=this._transform;return this._activePath.lineTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty),this}moveTo(t,e){this._tick++;const r=this._transform,i=this._activePath.instructions,n=r.a*t+r.c*e+r.tx,s=r.b*t+r.d*e+r.ty;return 1===i.length&&"moveTo"===i[0].action?(i[0].data[0]=n,i[0].data[1]=s,this):(this._activePath.moveTo(n,s),this)}quadraticCurveTo(t,e,r,i,n){this._tick++;const s=this._transform;return this._activePath.quadraticCurveTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty,s.a*r+s.c*i+s.tx,s.b*r+s.d*i+s.ty,n),this}rect(t,e,r,i){return this._tick++,this._activePath.rect(t,e,r,i,this._transform.clone()),this}roundRect(t,e,r,i,n){return this._tick++,this._activePath.roundRect(t,e,r,i,n,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,r,i,n=0,s){return this._tick++,this._activePath.regularPoly(t,e,r,i,n,s),this}roundPoly(t,e,r,i,n,s){return this._tick++,this._activePath.roundPoly(t,e,r,i,n,s),this}roundShape(t,e,r,i){return this._tick++,this._activePath.roundShape(t,e,r,i),this}filletRect(t,e,r,i,n){return this._tick++,this._activePath.filletRect(t,e,r,i,n),this}chamferRect(t,e,r,i,n,s){return this._tick++,this._activePath.chamferRect(t,e,r,i,n,s),this}star(t,e,r,i,n=0,s=0){return this._tick++,this._activePath.star(t,e,r,i,n,s,this._transform.clone()),this}svg(t){return this._tick++,function(t,e){if("string"==typeof t){const e=document.createElement("div");e.innerHTML=t.trim(),t=e.querySelector("svg")}const r={context:e,defs:{},path:new E};!function(t,e){const r=t.querySelectorAll("defs");for(let t=0;t<r.length;t++){const i=r[t];for(let t=0;t<i.children.length;t++){const r=i.children[t];switch(r.nodeName.toLowerCase()){case"lineargradient":e.defs[r.id]=q(r);break;case"radialgradient":e.defs[r.id]=((0,c.R)("[SVG Parser] Radial gradients are not yet supported"),new j._(0,0,1,0))}}}}(t,r);const i=t.children,{fillStyle:n,strokeStyle:s}=Z(t,r);for(let t=0;t<i.length;t++){const e=i[t];"defs"!==e.nodeName.toLowerCase()&&Q(e,r,n,s)}}(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,r,i,n,a){return t instanceof s.u?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,r,i,n,a),this)}transform(t,e,r,i,n,a){return t instanceof s.u?(this._transform.append(t),this):(et.set(t,e,r,i,n,a),this._transform.append(et),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const r=this.instructions[e],i=r.action;if("fill"===i){const e=r.data;t.addBounds(e.path.bounds)}else if("texture"===i){const e=r.data;t.addFrame(e.dx,e.dy,e.dx+e.dw,e.dy+e.dh,e.transform)}if("stroke"===i){const e=r.data,i=e.style.alignment,n=e.style.width*(1-i),s=e.path.bounds;t.addFrame(s.minX-n,s.minY-n,s.maxX+n,s.maxY+n)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let r=!1;for(let i=0;i<e.length;i++){const n=e[i],s=n.data,a=s.path;if(!n.action||!a)continue;const o=s.style,l=a.shapePath.shapePrimitives;for(let e=0;e<l.length;e++){const i=l[e].shape;if(!o||!i)continue;const a=l[e].transform,h=a?a.applyInverse(t,tt):t;if("fill"===n.action)r=i.contains(h.x,h.y);else{const t=o;r=i.strokeContains(h.x,h.y,t.width,t.alignment)}const u=s.hole;if(u){const t=u.shapePath?.shapePrimitives;if(t)for(let e=0;e<t.length;e++)t[e].shape.contains(h.x,h.y)&&(r=!1)}if(r)return!0}}return r}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),"boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(e),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(e)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};rt.defaultFillStyle={color:16777215,alpha:1,texture:o.g.WHITE,matrix:null,fill:null,textureSpace:"local"},rt.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:o.g.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let it=rt},6101:(t,e,r)=>{"use strict";r.d(e,{GH:()=>ut});var i=r(8507),n=r(341),s=r(3721),a=r(848),o=r(4670),l=r(8218),h=r(9313),u=r(9252);function c(t,e,r,i,n){const s=e.a,a=e.b,o=e.c,l=e.d,h=e.tx,u=e.ty;r||(r=0),i||(i=2),n||(n=t.length/i-r);let c=r*i;for(let e=0;e<n;e++){const e=t[c],r=t[c+1];t[c]=s*e+o*r+h,t[c+1]=a*e+l*r+u,c+=i}}var d=r(4492),p=r(6954);const f={extension:{type:i.Ag.ShapeBuilder,name:"circle"},build(t,e){let r,i,n,s,a,o;if("circle"===t.type){const e=t;if(a=o=e.radius,a<=0)return!1;r=e.x,i=e.y,n=s=0}else if("ellipse"===t.type){const e=t;if(a=e.halfWidth,o=e.halfHeight,a<=0||o<=0)return!1;r=e.x,i=e.y,n=s=0}else{const e=t,l=e.width/2,h=e.height/2;r=e.x+l,i=e.y+h,a=o=Math.max(0,Math.min(e.radius,Math.min(l,h))),n=l-a,s=h-o}if(n<0||s<0)return!1;const l=Math.ceil(2.3*Math.sqrt(a+o)),h=8*l+(n?4:0)+(s?4:0);if(0===h)return!1;if(0===l)return e[0]=e[6]=r+n,e[1]=e[3]=i+s,e[2]=e[4]=r-n,e[5]=e[7]=i-s,!0;let u=0,c=4*l+(n?2:0)+2,d=c,p=h,f=n+a,g=s,x=r+f,m=r-f,y=i+g;if(e[u++]=x,e[u++]=y,e[--c]=y,e[--c]=m,s){const t=i-g;e[d++]=m,e[d++]=t,e[--p]=t,e[--p]=x}for(let t=1;t<l;t++){const h=Math.PI/2*(t/l),f=n+Math.cos(h)*a,g=s+Math.sin(h)*o,x=r+f,m=r-f,y=i+g,_=i-g;e[u++]=x,e[u++]=y,e[--c]=y,e[--c]=m,e[d++]=m,e[d++]=_,e[--p]=_,e[--p]=x}f=n,g=s+o,x=r+f,m=r-f,y=i+g;const _=i-g;return e[u++]=x,e[u++]=y,e[--p]=_,e[--p]=x,n&&(e[u++]=m,e[u++]=y,e[--p]=_,e[--p]=m),!0},triangulate(t,e,r,i,n,s){if(0===t.length)return;let a=0,o=0;for(let e=0;e<t.length;e+=2)a+=t[e],o+=t[e+1];a/=t.length/2,o/=t.length/2;let l=i;e[l*r]=a,e[l*r+1]=o;const h=l++;for(let i=0;i<t.length;i+=2)e[l*r]=t[i],e[l*r+1]=t[i+1],i>0&&(n[s++]=l,n[s++]=h,n[s++]=l-1),l++;n[s++]=h+1,n[s++]=h,n[s++]=l-1}},g={...f,extension:{...f.extension,name:"ellipse"}},x={...f,extension:{...f.extension,name:"roundedRectangle"}};var m=r(5101);const y=1e-4;function _(t,e,r,i,n,s,a,o){let l,h;a?(l=i,h=-r):(l=-i,h=r);const u=t-r*n+l,c=e-i*n+h,d=t+r*s+l,p=e+i*s+h;return o.push(u,c),o.push(d,p),2}function b(t,e,r,i,n,s,a,o){const l=r-t,h=i-e;let u=Math.atan2(l,h),c=Math.atan2(n-t,s-e);o&&u<c?u+=2*Math.PI:!o&&u>c&&(c+=2*Math.PI);let d=u;const p=c-u,f=Math.abs(p),g=Math.sqrt(l*l+h*h),x=1+(15*f*Math.sqrt(g)/Math.PI|0),m=p/x;if(d+=m,o){a.push(t,e),a.push(r,i);for(let r=1,i=d;r<x;r++,i+=m)a.push(t,e),a.push(t+Math.sin(i)*g,e+Math.cos(i)*g);a.push(t,e),a.push(n,s)}else{a.push(r,i),a.push(t,e);for(let r=1,i=d;r<x;r++,i+=m)a.push(t+Math.sin(i)*g,e+Math.cos(i)*g),a.push(t,e);a.push(n,s),a.push(t,e)}return 2*x}function v(t,e,r=2){const i=e&&e.length,n=i?e[0]*r:t.length;let s=S(t,0,n,r,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,h;if(i&&(s=function(t,e,r,i){const n=[];for(let r=0,s=e.length;r<s;r++){const a=S(t,e[r]*i,r<s-1?e[r+1]*i:t.length,i,!1);a===a.next&&(a.steiner=!0),n.push(z(a))}n.sort(F);for(let t=0;t<n.length;t++)r=R(n[t],r);return r}(t,e,s,r)),t.length>80*r){o=1/0,l=1/0;let e=-1/0,i=-1/0;for(let s=r;s<n;s+=r){const r=t[s],n=t[s+1];r<o&&(o=r),n<l&&(l=n),r>e&&(e=r),n>i&&(i=n)}h=Math.max(e-o,i-l),h=0!==h?32767/h:0}return T(s,a,r,o,l,h,0),a}function S(t,e,r,i,n){let s;if(n===function(t,e,r,i){let n=0;for(let s=e,a=r-i;s<r;s+=i)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}(t,e,r,i)>0)for(let n=e;n<r;n+=i)s=$(n/i|0,t[n],t[n+1],s);else for(let n=r-i;n>=e;n-=i)s=$(n/i|0,t[n],t[n+1],s);return s&&O(s,s.next)&&(j(s),s=s.next),s}function w(t,e){if(!t)return t;e||(e=t);let r,i=t;do{if(r=!1,i.steiner||!O(i,i.next)&&0!==D(i.prev,i,i.next))i=i.next;else{if(j(i),i=e=i.prev,i===i.next)break;r=!0}}while(r||i!==e);return e}function T(t,e,r,i,n,s,a){if(!t)return;!a&&s&&function(t,e,r,i){let n=t;do{0===n.z&&(n.z=B(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){let e,r=1;do{let i,n=t;t=null;let s=null;for(e=0;n;){e++;let a=n,o=0;for(let t=0;t<r&&(o++,a=a.nextZ,a);t++);let l=r;for(;o>0||l>0&&a;)0!==o&&(0===l||!a||n.z<=a.z)?(i=n,n=n.nextZ,o--):(i=a,a=a.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=a}s.nextZ=null,r*=2}while(e>1)}(n)}(t,i,n,s);let o=t;for(;t.prev!==t.next;){const l=t.prev,h=t.next;if(s?P(t,i,n,s):M(t))e.push(l.i,t.i,h.i),j(t),t=h.next,o=h.next;else if((t=h)===o){a?1===a?T(t=C(w(t),e),e,r,i,n,s,2):2===a&&k(t,e,r,i,n,s):T(w(t),e,r,i,n,s,1);break}}}function M(t){const e=t.prev,r=t,i=t.next;if(D(e,r,i)>=0)return!1;const n=e.x,s=r.x,a=i.x,o=e.y,l=r.y,h=i.y,u=Math.min(n,s,a),c=Math.min(o,l,h),d=Math.max(n,s,a),p=Math.max(o,l,h);let f=i.next;for(;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=c&&f.y<=p&&W(n,o,s,l,a,h,f.x,f.y)&&D(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function P(t,e,r,i){const n=t.prev,s=t,a=t.next;if(D(n,s,a)>=0)return!1;const o=n.x,l=s.x,h=a.x,u=n.y,c=s.y,d=a.y,p=Math.min(o,l,h),f=Math.min(u,c,d),g=Math.max(o,l,h),x=Math.max(u,c,d),m=B(p,f,e,r,i),y=B(g,x,e,r,i);let _=t.prevZ,b=t.nextZ;for(;_&&_.z>=m&&b&&b.z<=y;){if(_.x>=p&&_.x<=g&&_.y>=f&&_.y<=x&&_!==n&&_!==a&&W(o,u,l,c,h,d,_.x,_.y)&&D(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,b.x>=p&&b.x<=g&&b.y>=f&&b.y<=x&&b!==n&&b!==a&&W(o,u,l,c,h,d,b.x,b.y)&&D(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;_&&_.z>=m;){if(_.x>=p&&_.x<=g&&_.y>=f&&_.y<=x&&_!==n&&_!==a&&W(o,u,l,c,h,d,_.x,_.y)&&D(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=g&&b.y>=f&&b.y<=x&&b!==n&&b!==a&&W(o,u,l,c,h,d,b.x,b.y)&&D(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function C(t,e){let r=t;do{const i=r.prev,n=r.next.next;!O(i,n)&&L(i,r,r.next,n)&&H(i,n)&&H(n,i)&&(e.push(i.i,r.i,n.i),j(r),j(r.next),r=t=n),r=r.next}while(r!==t);return w(r)}function k(t,e,r,i,n,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&G(a,t)){let o=E(a,t);return a=w(a,a.next),o=w(o,o.next),T(a,e,r,i,n,s,0),void T(o,e,r,i,n,s,0)}t=t.next}a=a.next}while(a!==t)}function F(t,e){let r=t.x-e.x;return 0===r&&(r=t.y-e.y,0===r)&&(r=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function R(t,e){const r=function(t,e){let r=e;const i=t.x,n=t.y;let s,a=-1/0;if(O(t,r))return r;do{if(O(t,r.next))return r.next;if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){const t=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(t<=i&&t>a&&(a=t,s=r.x<r.next.x?r:r.next,t===i))return s}r=r.next}while(r!==e);if(!s)return null;const o=s,l=s.x,h=s.y;let u=1/0;r=s;do{if(i>=r.x&&r.x>=l&&i!==r.x&&U(n<h?i:a,n,l,h,n<h?a:i,n,r.x,r.y)){const e=Math.abs(n-r.y)/(i-r.x);H(r,t)&&(e<u||e===u&&(r.x>s.x||r.x===s.x&&A(s,r)))&&(s=r,u=e)}r=r.next}while(r!==o);return s}(t,e);if(!r)return e;const i=E(r,t);return w(i,i.next),w(r,r.next)}function A(t,e){return D(t.prev,t,e.prev)<0&&D(e.next,t,t.next)<0}function B(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function z(t){let e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function U(t,e,r,i,n,s,a,o){return(n-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(i-o)>=(r-a)*(e-o)&&(r-a)*(s-o)>=(n-a)*(i-o)}function W(t,e,r,i,n,s,a,o){return!(t===a&&e===o)&&U(t,e,r,i,n,s,a,o)}function G(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&L(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(H(t,e)&&H(e,t)&&function(t,e){let r=t,i=!1;const n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)&&(D(t.prev,t,e.prev)||D(t,e.prev,e))||O(t,e)&&D(t.prev,t,t.next)>0&&D(e.prev,e,e.next)>0)}function D(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function O(t,e){return t.x===e.x&&t.y===e.y}function L(t,e,r,i){const n=V(D(t,e,r)),s=V(D(t,e,i)),a=V(D(r,i,t)),o=V(D(r,i,e));return n!==s&&a!==o||!(0!==n||!I(t,r,e))||!(0!==s||!I(t,i,e))||!(0!==a||!I(r,t,i))||!(0!==o||!I(r,e,i))}function I(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function V(t){return t>0?1:t<0?-1:0}function H(t,e){return D(t.prev,t,t.next)<0?D(t,e,t.next)>=0&&D(t,t.prev,e)>=0:D(t,e,t.prev)<0||D(t,t.next,e)<0}function E(t,e){const r=X(t.i,t.x,t.y),i=X(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function $(t,e,r,i){const n=X(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function j(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function X(t,e,r){return{i:t,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}r(8875);const q=v.default||v;function Y(t,e,r,i,n,s,a){const o=q(t,e,2);if(!o)return;for(let t=0;t<o.length;t+=3)s[a++]=o[t]+n,s[a++]=o[t+1]+n,s[a++]=o[t+2]+n;let l=n*i;for(let e=0;e<t.length;e+=2)r[l]=t[e],r[l+1]=t[e+1],l+=i}const N=[],Z={extension:{type:i.Ag.ShapeBuilder,name:"polygon"},build(t,e){for(let r=0;r<t.points.length;r++)e[r]=t.points[r];return!0},triangulate(t,e,r,i,n,s){Y(t,N,e,r,i,n,s)}},K={extension:{type:i.Ag.ShapeBuilder,name:"rectangle"},build(t,e){const r=t,i=r.x,n=r.y,s=r.width,a=r.height;return s>0&&a>0&&(e[0]=i,e[1]=n,e[2]=i+s,e[3]=n,e[4]=i+s,e[5]=n+a,e[6]=i,e[7]=n+a,!0)},triangulate(t,e,r,i,n,s){let a=0;e[(i*=r)+a]=t[0],e[i+a+1]=t[1],a+=r,e[i+a]=t[2],e[i+a+1]=t[3],a+=r,e[i+a]=t[6],e[i+a+1]=t[7],a+=r,e[i+a]=t[4],e[i+a+1]=t[5],a+=r;const o=i/r;n[s++]=o,n[s++]=o+1,n[s++]=o+2,n[s++]=o+1,n[s++]=o+3,n[s++]=o+2}},Q={extension:{type:i.Ag.ShapeBuilder,name:"triangle"},build:(t,e)=>(e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,!0),triangulate(t,e,r,i,n,s){let a=0;e[(i*=r)+a]=t[0],e[i+a+1]=t[1],a+=r,e[i+a]=t[2],e[i+a+1]=t[3],a+=r,e[i+a]=t[4],e[i+a+1]=t[5];const o=i/r;n[s++]=o,n[s++]=o+1,n[s++]=o+2}};var J=r(7276);const tt=new h.u,et=new u.M,rt={};i.XO.handleByMap(i.Ag.ShapeBuilder,rt),i.XO.add(K,Z,Q,f,g,x);const it=new u.M,nt=new h.u;function st(t,e,r){const i=[],n=rt.rectangle,s=it;s.x=t.dx,s.y=t.dy,s.width=t.dw,s.height=t.dh;const a=t.transform;if(!n.build(s,i))return;const{vertices:o,uvs:h,indices:u}=r,d=u.length,f=o.length/2;a&&c(i,a),n.triangulate(i,o,2,f,u,d);const g=t.image,x=g.uvs;h.push(x.x0,x.y0,x.x1,x.y1,x.x3,x.y3,x.x2,x.y2);const m=l.Z.get(p.G);m.indexOffset=d,m.indexSize=u.length-d,m.attributeOffset=f,m.attributeSize=o.length/2-f,m.baseColor=t.style,m.alpha=t.alpha,m.texture=g,m.geometryData=r,e.push(m)}function at(t,e,r,i,n){const{vertices:s,uvs:a,indices:o}=n;t.shapePrimitives.forEach((({shape:t,transform:h,holes:u})=>{const f=[],g=rt[t.type];if(!g.build(t,f))return;const x=o.length,v=s.length/2;let S="triangle-list";if(h&&c(f,h),r){const r=t.closePath??!0,i=e;i.pixelLine?(function(t,e,r,i){const n=y;if(0===t.length)return;const s=t[0],a=t[1],o=t[t.length-2],l=t[t.length-1],h=e||Math.abs(s-o)<n&&Math.abs(a-l)<n,u=r,c=t.length/2,d=u.length/2;for(let e=0;e<c;e++)u.push(t[2*e]),u.push(t[2*e+1]);for(let t=0;t<c-1;t++)i.push(d+t,d+t+1);h&&i.push(d+c-1,d)}(f,r,s,o),S="line-list"):function(t,e,r,i,n,s){const a=y;if(0===t.length)return;const o=e;let l=o.alignment;if(.5!==e.alignment){let e=function(t){const e=t.length;if(e<6)return 1;let r=0;for(let i=0,n=t[e-2],s=t[e-1];i<e;i+=2){const e=t[i],a=t[i+1];r+=(e-n)*(a+s),n=e,s=a}return r<0?-1:1}(t);l=(l-.5)*e+.5}const h=new m.b(t[0],t[1]),u=new m.b(t[t.length-2],t[t.length-1]),c=i,d=Math.abs(h.x-u.x)<a&&Math.abs(h.y-u.y)<a;if(c){t=t.slice(),d&&(t.pop(),t.pop(),u.set(t[t.length-2],t[t.length-1]));const e=.5*(h.x+u.x),r=.5*(u.y+h.y);t.unshift(e,r),t.push(e,r)}const p=n,f=t.length/2;let g=t.length;const x=p.length/2,v=o.width/2,S=v*v,w=o.miterLimit*o.miterLimit;let T=t[0],M=t[1],P=t[2],C=t[3],k=0,F=0,R=-(M-C),A=T-P,B=0,z=0,U=Math.sqrt(R*R+A*A);R/=U,A/=U,R*=v,A*=v;const W=2*(1-l),G=2*l;c||("round"===o.cap?g+=b(T-R*(W-G)*.5,M-A*(W-G)*.5,T-R*W,M-A*W,T+R*G,M+A*G,p,!0)+2:"square"===o.cap&&(g+=_(T,M,R,A,W,G,!0,p))),p.push(T-R*W,M-A*W),p.push(T+R*G,M+A*G);for(let e=1;e<f-1;++e){T=t[2*(e-1)],M=t[2*(e-1)+1],P=t[2*e],C=t[2*e+1],k=t[2*(e+1)],F=t[2*(e+1)+1],R=-(M-C),A=T-P,U=Math.sqrt(R*R+A*A),R/=U,A/=U,R*=v,A*=v,B=-(C-F),z=P-k,U=Math.sqrt(B*B+z*z),B/=U,z/=U,B*=v,z*=v;const r=P-T,i=M-C,n=P-k,s=F-C,a=r*n+i*s,l=i*n-s*r,h=l<0;if(Math.abs(l)<.001*Math.abs(a)){p.push(P-R*W,C-A*W),p.push(P+R*G,C+A*G),a>=0&&("round"===o.join?g+=b(P,C,P-R*W,C-A*W,P-B*W,C-z*W,p,!1)+4:g+=2,p.push(P-B*G,C-z*G),p.push(P+B*W,C+z*W));continue}const u=(-R+T)*(-A+C)-(-R+P)*(-A+M),c=(-B+k)*(-z+C)-(-B+P)*(-z+F),d=(r*c-n*u)/l,f=(s*u-i*c)/l,x=(d-P)*(d-P)+(f-C)*(f-C),m=P+(d-P)*W,y=C+(f-C)*W,_=P-(d-P)*G,D=C-(f-C)*G,O=h?W:G;x<=Math.min(r*r+i*i,n*n+s*s)+O*O*S?"bevel"===o.join||x/S>w?(h?(p.push(m,y),p.push(P+R*G,C+A*G),p.push(m,y),p.push(P+B*G,C+z*G)):(p.push(P-R*W,C-A*W),p.push(_,D),p.push(P-B*W,C-z*W),p.push(_,D)),g+=2):"round"===o.join?h?(p.push(m,y),p.push(P+R*G,C+A*G),g+=b(P,C,P+R*G,C+A*G,P+B*G,C+z*G,p,!0)+4,p.push(m,y),p.push(P+B*G,C+z*G)):(p.push(P-R*W,C-A*W),p.push(_,D),g+=b(P,C,P-R*W,C-A*W,P-B*W,C-z*W,p,!1)+4,p.push(P-B*W,C-z*W),p.push(_,D)):(p.push(m,y),p.push(_,D)):(p.push(P-R*W,C-A*W),p.push(P+R*G,C+A*G),"round"===o.join?g+=h?b(P,C,P+R*G,C+A*G,P+B*G,C+z*G,p,!0)+2:b(P,C,P-R*W,C-A*W,P-B*W,C-z*W,p,!1)+2:"miter"===o.join&&x/S<=w&&(h?(p.push(_,D),p.push(_,D)):(p.push(m,y),p.push(m,y)),g+=2),p.push(P-B*W,C-z*W),p.push(P+B*G,C+z*G),g+=2)}T=t[2*(f-2)],M=t[2*(f-2)+1],P=t[2*(f-1)],C=t[2*(f-1)+1],R=-(M-C),A=T-P,U=Math.sqrt(R*R+A*A),R/=U,A/=U,R*=v,A*=v,p.push(P-R*W,C-A*W),p.push(P+R*G,C+A*G),c||("round"===o.cap?g+=b(P-R*(W-G)*.5,C-A*(W-G)*.5,P-R*W,C-A*W,P+R*G,C+A*G,p,!1)+2:"square"===o.cap&&(g+=_(P,C,R,A,W,G,!1,p)));for(let t=x;t<g+x-2;++t)T=p[2*t],M=p[2*t+1],P=p[2*(t+1)],C=p[2*(t+1)+1],k=p[2*(t+2)],F=p[2*(t+2)+1],Math.abs(T*(C-F)+P*(F-M)+k*(M-C))<1e-8||s.push(t,t+1,t+2)}(f,i,0,r,s,o)}else if(u){const t=[],e=f.slice();(function(t){const e=[];for(let r=0;r<t.length;r++){const i=t[r].shape,n=[];rt[i.type].build(i,n)&&e.push(n)}return e})(u).forEach((r=>{t.push(e.length/2),e.push(...r)})),Y(e,t,s,2,v,o,x)}else g.triangulate(f,s,2,v,o,x);const w=a.length/2,T=e.texture;if(T!==d.g.WHITE){const r=function(t,e,r,i){const n=e.matrix?t.copyFrom(e.matrix).invert():t.identity();if("local"===e.textureSpace){const t=r.getBounds(et);e.width&&t.pad(e.width);const{x:i,y:s}=t,a=1/t.width,o=1/t.height,l=-i*a,h=-s*o,u=n.a,c=n.b,d=n.c,p=n.d;n.a*=a,n.b*=a,n.c*=o,n.d*=o,n.tx=l*u+h*d+n.tx,n.ty=l*c+h*p+n.ty}else n.translate(e.texture.frame.x,e.texture.frame.y),n.scale(1/e.texture.source.width,1/e.texture.source.height);const s=e.texture.source.style;return e.fill instanceof J._||"clamp-to-edge"!==s.addressMode||(s.addressMode="repeat",s.update()),i&&n.append(tt.copyFrom(i).invert()),n}(nt,e,t,h);!function(t,e,r,i,n,s,a,o=null){let l=0;r*=e,n*=s;const h=o.a,u=o.b,c=o.c,d=o.d,p=o.tx,f=o.ty;for(;l<a;){const a=t[r],o=t[r+1];i[n]=h*a+c*o+p,i[n+1]=u*a+d*o+f,n+=s,r+=e,l++}}(s,2,v,a,w,2,s.length/2-v,r)}else!function(t,e,r,i){let n=0;for(e*=2;n<i;)t[e]=0,t[e+1]=0,e+=2,n++}(a,w,0,s.length/2-v);const M=l.Z.get(p.G);M.indexOffset=x,M.indexSize=o.length-x,M.attributeOffset=v,M.attributeSize=s.length/2-v,M.baseColor=e.color,M.alpha=e.alpha,M.texture=T,M.geometryData=n,M.topology=S,i.push(M)}))}class ot{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class lt{constructor(){this.instructions=new a.L}init(t){this.batcher=new s.J({maxTextures:t}),this.instructions.reset()}get geometry(){return(0,o.t6)(o.Ek,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}}const ht=class t{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(e){t.defaultOptions.bezierSmoothness=e?.bezierSmoothness??t.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),function(t,e){const{geometryData:r,batches:i}=e;i.length=0,r.indices.length=0,r.vertices.length=0,r.uvs.length=0;for(let e=0;e<t.instructions.length;e++){const n=t.instructions[e];if("texture"===n.action)st(n.data,i,r);else if("fill"===n.action||"stroke"===n.action){const t="stroke"===n.action,e=n.data.path.shapePath,s=n.data.style,a=n.data.hole;t&&a&&at(a.shapePath,s,!0,i,r),a&&(e.shapePrimitives[e.shapePrimitives.length-1].holes=a.shapePath.shapePrimitives),at(e,s,t,i,r)}}}(t,e);const r=t.batchMode;t.customShader||"no-batch"===r?e.isBatchable=!1:e.isBatchable="auto"!==r||e.geometryData.vertices.length<400,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=l.Z.get(lt,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:r,geometryData:i}=this._gpuContextHash[t.uid],s=i.vertices.length,a=i.indices.length;for(let t=0;t<r.length;t++)r[t].applyTransform=!1;const o=e.batcher;o.ensureAttributeBuffer(s),o.ensureIndexBuffer(a),o.begin();for(let t=0;t<r.length;t++){const e=r[t];o.add(e)}o.finish(e.instructions);const h=o.geometry;h.indexBuffer.setDataWithSize(o.indexBuffer,o.indexSize,!0),h.buffers[0].setDataWithSize(o.attributeBuffer.float32View,o.attributeSize,!0);const u=o.batches;for(let t=0;t<u.length;t++){const e=u[t];e.bindGroup=(0,n.w)(e.textures.textures,e.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new ot;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(l.Z.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach((t=>{l.Z.return(t)}))}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};ht.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem,i.Ag.CanvasSystem],name:"graphicsContext"},ht.defaultOptions={bezierSmoothness:.5};let ut=ht},7276:(t,e,r)=>{"use strict";r.d(e,{_:()=>p});var i=r(2577),n=r(1761),s=r(9313),a=r(8293),o=r(4492),l=r(133),h=r(4670),u=r(2698);const c=[{offset:0,color:"white"},{offset:1,color:"black"}],d=class t{constructor(...e){this.uid=(0,l.L)("fillGradient"),this.type="linear",this.colorStops=[];let r=function(t){let e=t[0]??{};return("number"==typeof e||t[1])&&((0,h.t6)("8.5.2","use options object instead"),e={type:"linear",start:{x:t[0],y:t[1]},end:{x:t[2],y:t[3]},textureSpace:t[4],textureSize:t[5]??p.defaultLinearOptions.textureSize}),e}(e);r={..."radial"===r.type?t.defaultRadialOptions:t.defaultLinearOptions,...(0,u.S)(r)},this._textureSize=r.textureSize,this._wrapMode=r.wrapMode,"radial"===r.type?(this.center=r.center,this.outerCenter=r.outerCenter??this.center,this.innerRadius=r.innerRadius,this.outerRadius=r.outerRadius,this.scale=r.scale,this.rotation=r.rotation):(this.start=r.start,this.end=r.end),this.textureSpace=r.textureSpace,this.type=r.type,r.colorStops.forEach((t=>{this.addColorStop(t.offset,t.color)}))}addColorStop(t,e){return this.colorStops.push({offset:t,color:i.Q.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:r,y:i}=this.end,n=r-t,l=i-e;const h=n<0||l<0;if("clamp-to-edge"===this._wrapMode){if(n<0){const e=t;t=r,r=e,n*=-1}if(l<0){const t=e;e=i,i=t,l*=-1}}const u=this.colorStops.length?this.colorStops:c,d=this._textureSize,{canvas:p,context:x}=g(d,1),m=h?x.createLinearGradient(this._textureSize,0,0,0):x.createLinearGradient(0,0,this._textureSize,0);f(m,u),x.fillStyle=m,x.fillRect(0,0,d,1),this.texture=new o.g({source:new a.b({resource:p,addressMode:this._wrapMode})});const y=Math.sqrt(n*n+l*l),_=Math.atan2(l,n),b=new s.u;b.scale(y/d,1),b.rotate(_),b.translate(t,e),"local"===this.textureSpace&&b.scale(d,d),this.transform=b}buildGradient(){"linear"===this.type?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:c,e=this._textureSize,{canvas:r,context:i}=g(e,e),{x:n,y:l}=this.center,{x:h,y:u}=this.outerCenter,d=this.innerRadius,p=this.outerRadius,x=h-p,m=u-p,y=e/(2*p),_=(n-x)*y,b=(l-m)*y,v=i.createRadialGradient(_,b,d*y,(h-x)*y,(u-m)*y,p*y);f(v,t),i.fillStyle=t[t.length-1].color,i.fillRect(0,0,e,e),i.fillStyle=v,i.translate(_,b),i.rotate(this.rotation),i.scale(1,this.scale),i.translate(-_,-b),i.fillRect(0,0,e,e),this.texture=new o.g({source:new a.b({resource:r,addressMode:this._wrapMode})});const S=new s.u;S.scale(1/y,1/y),S.translate(x,m),"local"===this.textureSpace&&S.scale(e,e),this.transform=S}get styleKey(){return this.uid}destroy(){this.texture?.destroy(!0),this.texture=null}};d.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"},d.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let p=d;function f(t,e){for(let r=0;r<e.length;r++){const i=e[r];t.addColorStop(i.offset,i.color)}}function g(t,e){const r=n.e.get().createCanvas(t,e),i=r.getContext("2d");return{canvas:r,context:i}}},2806:(t,e,r)=>{"use strict";r.d(e,{m:()=>a});var i=r(9313),n=r(133);const s={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class a{constructor(t,e){this.uid=(0,n.L)("fillPattern"),this.transform=new i.u,this._styleKey=null,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=s[e].addressModeU,t.source.style.addressModeV=s[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._styleKey=null}get styleKey(){return this._styleKey||(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`),this._styleKey}}},990:(t,e,r)=>{"use strict";r.d(e,{T:()=>d,w:()=>c});var i=r(2577),n=r(4492),s=r(7276),a=r(2806);function o(t){return t instanceof a.m}function l(t){return t instanceof s._}function h(t,e,r){return t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,{...r,...t}}function u(t,e,r){return e.buildGradient(),t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,t.textureSpace=e.textureSpace,{...r,...t}}function c(t,e){if(null==t)return null;const r={},s=t;return function(t){return i.Q.isColorLike(t)}(t)?function(t,e,r){const s=i.Q.shared.setValue(e??0);return t.color=s.toNumber(),t.alpha=1===s.alpha?r.alpha:s.alpha,t.texture=n.g.WHITE,{...r,...t}}(r,t,e):function(t){return t instanceof n.g}(t)?function(t,e,r){return t.texture=e,{...r,...t}}(r,t,e):o(t)?h(r,t,e):l(t)?u(r,t,e):s.fill&&o(s.fill)?h(s,s.fill,e):s.fill&&l(s.fill)?u(s,s.fill,e):function(t,e){const r={...e,...t},n=i.Q.shared.setValue(r.color);return r.alpha*=n.alpha,r.color=n.toNumber(),r}(s,e)}function d(t,e){const{width:r,alignment:i,miterLimit:n,cap:s,join:a,pixelLine:o,...l}=e,h=c(t,l);return h?{width:r,alignment:i,miterLimit:n,cap:s,join:a,pixelLine:o,...h}:null}},5285:(t,e,r)=>{"use strict";var i=r(8507),n=r(9313),s=r(3513),a=r(5811),o=r(8639),l=r(2760),h=r(8734);class u{destroy(){}}class c{constructor(t,e){this.localUniforms=new a.k({uTransformMatrix:{value:new n.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new s.T({0:this.localUniforms}),this.renderer=t,this._adaptor=e,this._adaptor.init()}validateRenderable(t){const e=this._getMeshData(t),r=e.batched,i=t.batched;if(e.batched=i,r!==i)return!0;if(i){const r=t._geometry;if(r.indices.length!==e.indexSize||r.positions.length!==e.vertexSize)return e.indexSize=r.indices.length,e.vertexSize=r.positions.length,!0;const i=this._getBatchableMesh(t);return i.texture.uid!==t._texture.uid&&(i._textureMatrixUpdateId=-1),!i._batcher.checkAndUpdateTexture(i,t._texture)}return!1}addRenderable(t,e){const r=this.renderer.renderPipes.batch,{batched:i}=this._getMeshData(t);if(i){const i=this._getBatchableMesh(t);i.setTexture(t._texture),i.geometry=t._geometry,r.addToBatch(i,e)}else r.break(e),e.add(t)}updateRenderable(t){if(t.batched){const e=this._getBatchableMesh(t);e.setTexture(t._texture),e.geometry=t._geometry,e._batcher.updateElement(e)}}execute(t){if(!t.isRenderable)return;t.state.blendMode=(0,o.i)(t.groupBlendMode,t.texture._source);const e=this.localUniforms;e.uniforms.uTransformMatrix=t.groupTransform,e.uniforms.uRound=this.renderer._roundPixels|t._roundPixels,e.update(),(0,l.V)(t.groupColorAlpha,e.uniforms.uColor,0),this._adaptor.execute(this,t)}_getMeshData(t){var e,r;return(e=t._gpuData)[r=this.renderer.uid]||(e[r]=new u),t._gpuData[this.renderer.uid].meshData||this._initMeshData(t)}_initMeshData(t){return t._gpuData[this.renderer.uid].meshData={batched:t.batched,indexSize:t._geometry.indices?.length,vertexSize:t._geometry.positions?.length},t._gpuData[this.renderer.uid].meshData}_getBatchableMesh(t){var e,r;return(e=t._gpuData)[r=this.renderer.uid]||(e[r]=new u),t._gpuData[this.renderer.uid].batchableMesh||this._initBatchableMesh(t)}_initBatchableMesh(t){const e=new h.U;return e.renderable=t,e.setTexture(t._texture),e.transform=t.groupTransform,e.roundPixels=this.renderer._roundPixels|t._roundPixels,t._gpuData[this.renderer.uid].batchableMesh=e,e}destroy(){this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}c.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"mesh"},i.XO.add(c)},8734:(t,e,r)=>{"use strict";r.d(e,{U:()=>i});class i{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(t){this._topology=t}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(t){this.texture!==t&&(this.texture=t,this._textureMatrixUpdateId=-1)}get uvs(){const t=this.geometry.getBuffer("aUV"),e=t.data;let r=e;const i=this.texture.textureMatrix;return i.isSimple||(r=this._transformedUvs,this._textureMatrixUpdateId===i._updateID&&this._uvUpdateId===t._updateID||((!r||r.length<e.length)&&(r=this._transformedUvs=new Float32Array(e.length)),this._textureMatrixUpdateId=i._updateID,this._uvUpdateId=t._updateID,i.multiplyUvs(e,r))),r}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}},5060:(t,e,r)=>{"use strict";r.d(e,{u:()=>l});var i=r(949),n=r(1132),s=r(6011),a=r(4670);const o=class t extends s.V{constructor(...e){let r=e[0]??{};r instanceof Float32Array&&((0,a.t6)(a.lj,"use new MeshGeometry({ positions, uvs, indices }) instead"),r={positions:r,uvs:e[1],indices:e[2]}),r={...t.defaultOptions,...r};const s=r.positions||new Float32Array([0,0,1,0,1,1,0,1]);let o=r.uvs;o||(o=r.positions?new Float32Array(s.length):new Float32Array([0,0,1,0,1,1,0,1]));const l=r.indices||new Uint32Array([0,1,2,0,2,3]),h=r.shrinkBuffersToFit;super({attributes:{aPosition:{buffer:new i.h({data:s,label:"attribute-mesh-positions",shrinkToFit:h,usage:n.S.VERTEX|n.S.COPY_DST}),format:"float32x2",stride:8,offset:0},aUV:{buffer:new i.h({data:o,label:"attribute-mesh-uvs",shrinkToFit:h,usage:n.S.VERTEX|n.S.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new i.h({data:l,label:"index-mesh-buffer",shrinkToFit:h,usage:n.S.INDEX|n.S.COPY_DST}),topology:r.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};o.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let l=o},9305:(t,e,r)=>{"use strict";var i=r(8507);class n{execute(t,e){const r=t.state,i=t.renderer,n=e.shader||t.defaultShader;n.resources.uTexture=e.texture._source,n.resources.uniforms=t.localUniforms;const s=i.gl,a=t.getBuffers(e);i.shader.bind(n),i.state.set(r),i.geometry.bind(a.geometry,n.glProgram);const o=2===a.geometry.indexBuffer.data.BYTES_PER_ELEMENT?s.UNSIGNED_SHORT:s.UNSIGNED_INT;s.drawElements(s.TRIANGLES,6*e.particleChildren.length,o,0)}}var s=r(9313),a=r(5811),o=r(8639),l=r(7547),h=r(2760),u=r(949),c=r(1132),d=r(6011),p=r(8306),f=r(1460);function g(t,e=null){const r=6*t;if(r>65535?e||(e=new Uint32Array(r)):e||(e=new Uint16Array(r)),e.length!==r)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${r}`);for(let t=0,i=0;t<r;t+=6,i+=4)e[t+0]=i+0,e[t+1]=i+1,e[t+2]=i+2,e[t+3]=i+0,e[t+4]=i+2,e[t+5]=i+3;return e}function x(t,e){const r=[];r.push("\n\n        var index = 0;\n\n        for (let i = 0; i < ps.length; ++i)\n        {\n            const p = ps[i];\n\n            ");let i=0;for(const n in t){const s=t[n];e===s.dynamic&&(r.push(`offset = index + ${i}`),r.push(s.code),i+=(0,p.m)(s.format).stride/4)}r.push("\n            index += stride * 4;\n        }\n    "),r.unshift(`\n        var stride = ${i};\n    `);const n=r.join("\n");return new Function("ps","f32v","u32v",n)}class m{constructor(t){this._size=0,this._generateParticleUpdateCache={};const e=this._size=t.size??1e3,r=t.properties;let i=0,n=0;for(const t in r){const e=r[t],s=(0,p.m)(e.format);e.dynamic?n+=s.stride:i+=s.stride}this._dynamicStride=n/4,this._staticStride=i/4,this.staticAttributeBuffer=new f.u(4*e*i),this.dynamicAttributeBuffer=new f.u(4*e*n),this.indexBuffer=g(e);const s=new d.V;let a=0,o=0;this._staticBuffer=new u.h({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:c.S.VERTEX|c.S.COPY_DST}),this._dynamicBuffer=new u.h({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:c.S.VERTEX|c.S.COPY_DST});for(const t in r){const e=r[t],i=(0,p.m)(e.format);e.dynamic?(s.addAttribute(e.attributeName,{buffer:this._dynamicBuffer,stride:4*this._dynamicStride,offset:4*a,format:e.format}),a+=i.size):(s.addAttribute(e.attributeName,{buffer:this._staticBuffer,stride:4*this._staticStride,offset:4*o,format:e.format}),o+=i.size)}s.addIndex(this.indexBuffer);const l=this.getParticleUpdate(r);this._dynamicUpload=l.dynamicUpdate,this._staticUpload=l.staticUpdate,this.geometry=s}getParticleUpdate(t){const e=function(t){const e=[];for(const r in t){const i=t[r];e.push(r,i.code,i.dynamic?"d":"s")}return e.join("_")}(t);return this._generateParticleUpdateCache[e]||(this._generateParticleUpdateCache[e]=this.generateParticleUpdate(t)),this._generateParticleUpdateCache[e]}generateParticleUpdate(t){return function(t){return{dynamicUpdate:x(t,!0),staticUpdate:x(t,!1)}}(t)}update(t,e){t.length>this._size&&(e=!0,this._size=Math.max(t.length,1.5*this._size|0),this.staticAttributeBuffer=new f.u(this._size*this._staticStride*4*4),this.dynamicAttributeBuffer=new f.u(this._size*this._dynamicStride*4*4),this.indexBuffer=g(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));const r=this.dynamicAttributeBuffer;if(this._dynamicUpload(t,r.float32View,r.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,t.length*this._dynamicStride*4,!0),e){const e=this.staticAttributeBuffer;this._staticUpload(t,e.float32View,e.uint32View),this._staticBuffer.setDataWithSize(e.float32View,t.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}var y=r(2577),_=r(9113),b=r(3012),v=r(8475),S=r(4492),w=r(218),T="\nstruct ParticleUniforms {\n  uProjectionMatrix:mat3x3<f32>,\n  uColor:vec4<f32>,\n  uResolution:vec2<f32>,\n  uRoundPixels:f32,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;\n\n@group(1) @binding(0) var uTexture: texture_2d<f32>;\n@group(1) @binding(1) var uSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) color : vec4<f32>,\n  };\n@vertex\nfn mainVertex(\n  @location(0) aVertex: vec2<f32>,\n  @location(1) aPosition: vec2<f32>,\n  @location(2) aUV: vec2<f32>,\n  @location(3) aColor: vec4<f32>,\n  @location(4) aRotation: f32,\n) -> VSOutput {\n  \n   let v = vec2(\n       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),\n       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)\n   ) + aPosition;\n\n   let position = vec4((uniforms.uProjectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;\n\n  return VSOutput(\n   position,\n   aUV,\n   vColor,\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) color: vec4<f32>,\n  @builtin(position) position: vec4<f32>,\n) -> @location(0) vec4<f32> {\n\n    var sample = textureSample(uTexture, uSampler, uv) * color;\n   \n    return sample;\n}";class M extends v.M{constructor(){super({glProgram:_.M.from({vertex:"attribute vec2 aVertex;\nattribute vec2 aUV;\nattribute vec4 aColor;\n\nattribute vec2 aPosition;\nattribute float aRotation;\n\nuniform mat3 uTranslationMatrix;\nuniform float uRound;\nuniform vec2 uResolution;\nuniform vec4 uColor;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n\nvec2 roundPixels(vec2 position, vec2 targetSize)\n{       \n    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\nvoid main(void){\n    float cosRotation = cos(aRotation);\n    float sinRotation = sin(aRotation);\n    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;\n    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;\n\n    vec2 v = vec2(x, y);\n    v = v + aPosition;\n\n    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    if(uRound == 1.0)\n    {\n        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n    }\n\n    vUV = aUV;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;\n}\n",fragment:"varying vec2 vUV;\nvarying vec4 vColor;\n\nuniform sampler2D uTexture;\n\nvoid main(void){\n    vec4 color = texture2D(uTexture, vUV) * vColor;\n    gl_FragColor = color;\n}"}),gpuProgram:b.B.from({fragment:{source:T,entryPoint:"mainFragment"},vertex:{source:T,entryPoint:"mainVertex"}}),resources:{uTexture:S.g.WHITE.source,uSampler:new w.n({}),uniforms:{uTranslationMatrix:{value:new s.u,type:"mat3x3<f32>"},uColor:{value:new y.Q(16777215),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class P{constructor(t,e){this.state=l.U.for2d(),this.localUniforms=new a.k({uTranslationMatrix:{value:new s.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=t,this.adaptor=e,this.defaultShader=new M,this.state=l.U.for2d()}validateRenderable(t){return!1}addRenderable(t,e){this.renderer.renderPipes.batch.break(e),e.add(t)}getBuffers(t){return t._gpuData[this.renderer.uid]||this._initBuffer(t)}_initBuffer(t){return t._gpuData[this.renderer.uid]=new m({size:t.particleChildren.length,properties:t._properties}),t._gpuData[this.renderer.uid]}updateRenderable(t){}execute(t){const e=t.particleChildren;if(0===e.length)return;const r=this.renderer,i=this.getBuffers(t);t.texture||(t.texture=e[0].texture);const n=this.state;i.update(e,t._childrenDirty),t._childrenDirty=!1,n.blendMode=(0,o.i)(t.blendMode,t.texture._source);const s=this.localUniforms.uniforms,a=s.uTranslationMatrix;t.worldTransform.copyTo(a),a.prepend(r.globalUniforms.globalUniformData.projectionMatrix),s.uResolution=r.globalUniforms.globalUniformData.resolution,s.uRound=r._roundPixels|t._roundPixels,(0,h.V)(t.groupColorAlpha,s.uColor,0),this.adaptor.execute(this,t)}destroy(){this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class C extends P{constructor(t){super(t,new n)}}C.extension={type:[i.Ag.WebGLPipes],name:"particle"};class k{execute(t,e){const r=t.renderer,i=e.shader||t.defaultShader;i.groups[0]=r.renderPipes.uniformBatch.getUniformBindGroup(t.localUniforms,!0),i.groups[1]=r.texture.getTextureBindGroup(e.texture);const n=t.state,s=t.getBuffers(e);r.encoder.draw({geometry:s.geometry,shader:e.shader||t.defaultShader,state:n,size:6*e.particleChildren.length})}}class F extends P{constructor(t){super(t,new k)}}F.extension={type:[i.Ag.WebGPUPipes],name:"particle"},i.XO.add(C),i.XO.add(F)},7252:(t,e,r)=>{"use strict";var i=r(8507),n=r(8734),s=r(4670),a=r(5060);const o=class t extends a.u{constructor(...t){super({});let e=t[0]??{};"number"==typeof e&&((0,s.t6)(s.lj,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),e={width:e,height:t[1],verticesX:t[2],verticesY:t[3]}),this.build(e)}build(e){e={...t.defaultOptions,...e},this.verticesX=this.verticesX??e.verticesX,this.verticesY=this.verticesY??e.verticesY,this.width=this.width??e.width,this.height=this.height??e.height;const r=this.verticesX*this.verticesY,i=[],n=[],s=[],a=this.verticesX-1,o=this.verticesY-1,l=this.width/a,h=this.height/o;for(let t=0;t<r;t++){const e=t%this.verticesX,r=t/this.verticesX|0;i.push(e*l,r*h),n.push(e/a,r/o)}const u=a*o;for(let t=0;t<u;t++){const e=t%a,r=t/a|0,i=r*this.verticesX+e,n=r*this.verticesX+e+1,o=(r+1)*this.verticesX+e,l=(r+1)*this.verticesX+e+1;s.push(i,n,o,n,l,o)}this.buffers[0].data=new Float32Array(i),this.buffers[1].data=new Float32Array(n),this.indexBuffer.data=new Uint32Array(s),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};o.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let l=o;const h=class t extends l{constructor(e={}){super({width:(e={...t.defaultOptions,...e}).width,height:e.height,verticesX:4,verticesY:4}),this.update(e)}update(t){this.width=t.width??this.width,this.height=t.height??this.height,this._originalWidth=t.originalWidth??this._originalWidth,this._originalHeight=t.originalHeight??this._originalHeight,this._leftWidth=t.leftWidth??this._leftWidth,this._rightWidth=t.rightWidth??this._rightWidth,this._topHeight=t.topHeight??this._topHeight,this._bottomHeight=t.bottomHeight??this._bottomHeight,this._anchorX=t.anchor?.x,this._anchorY=t.anchor?.y,this.updateUvs(),this.updatePositions()}updatePositions(){const t=this.positions,{width:e,height:r,_leftWidth:i,_rightWidth:n,_topHeight:s,_bottomHeight:a,_anchorX:o,_anchorY:l}=this,h=i+n,u=e>h?1:e/h,c=s+a,d=r>c?1:r/c,p=Math.min(u,d),f=o*e,g=l*r;t[0]=t[8]=t[16]=t[24]=-f,t[2]=t[10]=t[18]=t[26]=i*p-f,t[4]=t[12]=t[20]=t[28]=e-n*p-f,t[6]=t[14]=t[22]=t[30]=e-f,t[1]=t[3]=t[5]=t[7]=-g,t[9]=t[11]=t[13]=t[15]=s*p-g,t[17]=t[19]=t[21]=t[23]=r-a*p-g,t[25]=t[27]=t[29]=t[31]=r-g,this.getBuffer("aPosition").update()}updateUvs(){const t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;const e=1/this._originalWidth,r=1/this._originalHeight;t[2]=t[10]=t[18]=t[26]=e*this._leftWidth,t[9]=t[11]=t[13]=t[15]=r*this._topHeight,t[4]=t[12]=t[20]=t[28]=1-e*this._rightWidth,t[17]=t[19]=t[21]=t[23]=1-r*this._bottomHeight,this.getBuffer("aUV").update()}};h.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let u=h;class c extends n.U{constructor(){super(),this.geometry=new u}destroy(){this.geometry.destroy()}}class d{constructor(t){this._renderer=t}addRenderable(t,e){const r=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,r),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,e),e._batcher.updateElement(e)}validateRenderable(t){const e=this._getGpuSprite(t);return!e._batcher.checkAndUpdateTexture(e,t._texture)}_updateBatchableSprite(t,e){e.geometry.update(t),e.setTexture(t._texture)}_getGpuSprite(t){return t._gpuData[this._renderer.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const e=t._gpuData[this._renderer.uid]=new c,r=e;return r.renderable=t,r.transform=t.groupTransform,r.texture=t._texture,r.roundPixels=this._renderer._roundPixels|t._roundPixels,t.didViewUpdate||this._updateBatchableSprite(t,r),e}destroy(){this._renderer=null}}d.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"nineSliceSprite"},i.XO.add(d)},8723:(t,e,r)=>{"use strict";var i=r(8507),n=r(8639),s=r(7547),a=r(5099),o=r(2760),l=r(8734),h=r(5060),u=r(9313),c=r(5611),d=r(2067),p=r(6665),f=r(8475),g=r(5811),x=r(4492);const m={name:"tiling-bit",vertex:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;\n\n            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;\n        "},fragment:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n\n            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);\n            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;\n            var unclamped = coord;\n            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);\n\n            var bias = 0.;\n\n            if(unclamped.x == coord.x && unclamped.y == coord.y)\n            {\n                bias = -32.;\n            }\n\n            outColor = textureSampleBias(uTexture, uSampler, coord, bias);\n        "}},y={name:"tiling-bit",vertex:{header:"\n            uniform mat3 uTextureTransform;\n            uniform vec4 uSizeAnchor;\n\n        ",main:"\n            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;\n\n            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;\n        "},fragment:{header:"\n            uniform sampler2D uTexture;\n            uniform mat3 uMapCoord;\n            uniform vec4 uClampFrame;\n            uniform vec2 uClampOffset;\n        ",main:"\n\n        vec2 coord = vUV + ceil(uClampOffset - vUV);\n        coord = (uMapCoord * vec3(coord, 1.0)).xy;\n        vec2 unclamped = coord;\n        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0\n\n        "}};let _,b;class v extends f.M{constructor(){_??(_=(0,c.v)({name:"tiling-sprite-shader",bits:[d.Ls,m,p.b]})),b??(b=(0,c.I)({name:"tiling-sprite-shader",bits:[d.mA,y,p.m]}));const t=new g.k({uMapCoord:{value:new u.u,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new u.u,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:b,gpuProgram:_,resources:{localUniforms:new g.k({uTransformMatrix:{value:new u.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:t,uTexture:x.g.EMPTY.source,uSampler:x.g.EMPTY.source.style}})}updateUniforms(t,e,r,i,n,s){const a=this.resources.tilingUniforms,o=s.width,l=s.height,h=s.textureMatrix,u=a.uniforms.uTextureTransform;u.set(r.a*o/t,r.b*o/e,r.c*l/t,r.d*l/e,r.tx/t,r.ty/e),u.invert(),a.uniforms.uMapCoord=h.mapCoord,a.uniforms.uClampFrame=h.uClampFrame,a.uniforms.uClampOffset=h.uClampOffset,a.uniforms.uTextureTransform=u,a.uniforms.uSizeAnchor[0]=t,a.uniforms.uSizeAnchor[1]=e,a.uniforms.uSizeAnchor[2]=i,a.uniforms.uSizeAnchor[3]=n,s&&(this.resources.uTexture=s.source,this.resources.uSampler=s.source.style)}}class S extends h.u{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}const w=new S;class T{constructor(){this.canBatch=!0,this.geometry=new h.u({indices:w.indices.slice(),positions:w.positions.slice(),uvs:w.uvs.slice()})}destroy(){this.geometry.destroy(),this.shader?.destroy()}}class M{constructor(t){this._state=s.U.default2d,this._renderer=t}validateRenderable(t){const e=this._getTilingSpriteData(t),r=e.canBatch;this._updateCanBatch(t);const i=e.canBatch;if(i&&i===r){const{batchableMesh:r}=e;return!r._batcher.checkAndUpdateTexture(r,t.texture)}return r!==i}addRenderable(t,e){const r=this._renderer.renderPipes.batch;this._updateCanBatch(t);const i=this._getTilingSpriteData(t),{geometry:n,canBatch:s}=i;if(s){i.batchableMesh||(i.batchableMesh=new l.U);const s=i.batchableMesh;t.didViewUpdate&&(this._updateBatchableMesh(t),s.geometry=n,s.renderable=t,s.transform=t.groupTransform,s.setTexture(t._texture)),s.roundPixels=this._renderer._roundPixels|t._roundPixels,r.addToBatch(s,e)}else r.break(e),i.shader||(i.shader=new v),this.updateRenderable(t),e.add(t)}execute(t){const{shader:e}=this._getTilingSpriteData(t);e.groups[0]=this._renderer.globalUniforms.bindGroup;const r=e.resources.localUniforms.uniforms;r.uTransformMatrix=t.groupTransform,r.uRound=this._renderer._roundPixels|t._roundPixels,(0,o.V)(t.groupColorAlpha,r.uColor,0),this._state.blendMode=(0,n.i)(t.groupBlendMode,t.texture._source),this._renderer.encoder.draw({geometry:w,shader:e,state:this._state})}updateRenderable(t){const e=this._getTilingSpriteData(t),{canBatch:r}=e;if(r){const{batchableMesh:r}=e;t.didViewUpdate&&this._updateBatchableMesh(t),r._batcher.updateElement(r)}else if(t.didViewUpdate){const{shader:r}=e;r.updateUniforms(t.width,t.height,t._tileTransform.matrix,t.anchor.x,t.anchor.y,t.texture)}}_getTilingSpriteData(t){return t._gpuData[this._renderer.uid]||this._initTilingSpriteData(t)}_initTilingSpriteData(t){const e=new T;return e.renderable=t,t._gpuData[this._renderer.uid]=e,e}_updateBatchableMesh(t){const e=this._getTilingSpriteData(t),{geometry:r}=e,i=t.texture.source.style;"repeat"!==i.addressMode&&(i.addressMode="repeat",i.update()),function(t,e){const r=t.texture,i=r.frame.width,n=r.frame.height;let s=0,a=0;t.applyAnchorToTexture&&(s=t.anchor.x,a=t.anchor.y),e[0]=e[6]=-s,e[2]=e[4]=1-s,e[1]=e[3]=-a,e[5]=e[7]=1-a;const o=u.u.shared;o.copyFrom(t._tileTransform.matrix),o.tx/=t.width,o.ty/=t.height,o.invert(),o.scale(t.width/i,t.height/n),function(t,e,r,i){let n=0;const s=t.length/2,a=i.a,o=i.b,l=i.c,h=i.d,u=i.tx,c=i.ty;for(r*=2;n<s;){const e=t[r],i=t[r+1];t[r]=a*e+l*i+u,t[r+1]=o*e+h*i+c,r+=2,n++}}(e,0,0,o)}(t,r.uvs),function(t,e){const r=t.anchor.x,i=t.anchor.y;e[0]=-r*t.width,e[1]=-i*t.height,e[2]=(1-r)*t.width,e[3]=-i*t.height,e[4]=(1-r)*t.width,e[5]=(1-i)*t.height,e[6]=-r*t.width,e[7]=(1-i)*t.height}(t,r.positions)}destroy(){this._renderer=null}_updateCanBatch(t){const e=this._getTilingSpriteData(t),r=t.texture;let i=!0;return this._renderer.type===a.W.WEBGL&&(i=this._renderer.context.supports.nonPowOf2wrapping),e.canBatch=r.textureMatrix.isSimple&&(i||r.source.isPowerOfTwo),e.canBatch}}M.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"tilingSprite"},i.XO.add(M)},1849:(t,e,r)=>{"use strict";r.d(e,{v:()=>s});var i=r(8875),n=r(4670);class s extends i.A{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return(0,n.t6)(n.lj,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return(0,n.t6)(n.lj,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return(0,n.t6)(n.lj,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return(0,n.t6)(n.lj,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return(0,n.t6)(n.lj,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners();for(const t in this.chars)this.chars[t].texture?.destroy();this.chars=null,t&&(this.pages.forEach((t=>t.texture.destroy(!0))),this.pages=null)}}},1312:(t,e,r)=>{"use strict";r.d(e,{c:()=>v});var i=r(1979),n=r(4670),s=r(268),a=r(4016),o=r(9690),l=r(2577),h=r(9252),u=r(7608),c=r(8293),d=r(4492),p=r(218),f=r(1242),g=r(3548),x=r(1849);const m=class t extends x.v{constructor(e){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const r={...t.defaultOptions,...e};this._textureSize=r.textureSize,this._mipmap=r.mipmap;const i=r.style.clone();r.overrideFill&&(i._fill.color=16777215,i._fill.alpha=1,i._fill.texture=d.g.WHITE,i._fill.fill=null),this.applyFillAsTint=r.overrideFill;const n=i.fontSize;i.fontSize=this.baseMeasurementFontSize;const s=(0,f.Z)(i);r.overrideSize?i._stroke&&(i._stroke.width*=this.baseRenderedFontSize/n):i.fontSize=this.baseRenderedFontSize=n,this._style=i,this._skipKerning=r.skipKerning??!1,this.resolution=r.resolution??1,this._padding=r.padding??4,r.textureStyle&&(this._textureStyle=r.textureStyle instanceof p.n?r.textureStyle:new p.n(r.textureStyle)),this.fontMetrics=a.P.measureFont(s),this.lineHeight=i.lineHeight||this.fontMetrics.fontSize||i.fontSize}ensureCharacters(t){const e=a.P.graphemeSegmenter(t).filter((t=>!this._currentChars.includes(t))).filter(((t,e,r)=>r.indexOf(t)===e));if(!e.length)return;let r;this._currentChars=[...this._currentChars,...e],r=-1===this._currentPageIndex?this._nextPage():this.pages[this._currentPageIndex];let{canvas:i,context:n}=r.canvasAndContext,s=r.texture.source;const o=this._style;let l=this._currentX,u=this._currentY,c=this._currentMaxCharHeight;const p=this.baseRenderedFontSize/this.baseMeasurementFontSize,f=this._padding*p;let g=!1;const x=i.width/this.resolution,m=i.height/this.resolution;for(let t=0;t<e.length;t++){const r=e[t],y=a.P.measureText(r,o,i,!1);y.lineHeight=y.height;const _=y.width*p,b=Math.ceil(("italic"===o.fontStyle?2:1)*_)+2*f,v=y.height*p+2*f;if(g=!1,"\n"!==r&&"\r"!==r&&"\t"!==r&&" "!==r&&(g=!0,c=Math.ceil(Math.max(v,c))),l+b>x&&(u+=c,c=v,l=0,u+c>m)){s.update();const t=this._nextPage();i=t.canvasAndContext.canvas,n=t.canvasAndContext.context,s=t.texture.source,l=0,u=0,c=0}const S=_/p-(o.dropShadow?.distance??0)-(o._stroke?.width??0);if(this.chars[r]={id:r.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:S,kerning:{}},g){this._drawGlyph(n,y,l+f,u+f,p,o);const t=s.width*p,e=s.height*p,i=new h.M(l/t*s.width,u/e*s.height,b/t*s.width,v/e*s.height);this.chars[r].texture=new d.g({source:s,frame:i}),l+=Math.ceil(b)}}s.update(),this._currentX=l,this._currentY=u,this._currentMaxCharHeight=c,this._skipKerning&&this._applyKerning(e,n)}get pageTextures(){return(0,n.t6)(n.lj,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const r=this._measureCache;for(let i=0;i<t.length;i++){const n=t[i];for(let t=0;t<this._currentChars.length;t++){const i=this._currentChars[t];let s=r[n];s||(s=r[n]=e.measureText(n).width);let a=r[i];a||(a=r[i]=e.measureText(i).width);let o=e.measureText(n+i).width,l=o-(s+a);l&&(this.chars[n].kerning[i]=l),o=e.measureText(n+i).width,l=o-(s+a),l&&(this.chars[i].kerning[n]=l)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=u.N.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const r=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),i=new d.g({source:new c.b({resource:e.canvas,resolution:r,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(i.source.style=this._textureStyle);const n={canvasAndContext:e,texture:i};return this.pages[this._currentPageIndex]=n,n}_setupContext(t,e,r){e.fontSize=this.baseRenderedFontSize,t.scale(r,r),t.font=(0,f.Z)(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const i=e._stroke,n=i?.width??0;if(i&&(t.lineWidth=n,t.lineJoin=i.join,t.miterLimit=i.miterLimit,t.strokeStyle=(0,g.r)(i,t)),e._fill&&(t.fillStyle=(0,g.r)(e._fill,t)),e.dropShadow){const i=e.dropShadow,n=l.Q.shared.setValue(i.color).toArray(),s=i.blur*r,a=i.distance*r;t.shadowColor=`rgba(${255*n[0]},${255*n[1]},${255*n[2]},${i.alpha})`,t.shadowBlur=s,t.shadowOffsetX=Math.cos(i.angle)*a,t.shadowOffsetY=Math.sin(i.angle)*a}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,r,i,n,s){const a=e.text,o=e.fontProperties,l=s._stroke,h=(l?.width??0)*n,u=r+h/2,c=i-h/2,d=o.descent*n,p=e.lineHeight*n;s.stroke&&h&&t.strokeText(a,u,c+p-d),s._fill&&t.fillText(a,u,c+p-d)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:r}=this.pages[t];u.N.returnCanvasAndContext(e),r.destroy(!0)}this.pages=null}};m.defaultOptions={textureSize:512,style:new o.x,mipmap:!0};let y=m;var _=r(2763);let b=0;const v=new class{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null}}getFont(t,e){let r=`${e.fontFamily}-bitmap`,n=!0;if(e._fill.fill&&!e._stroke)r+=e._fill.fill.styleKey,n=!1;else if(e._stroke||e.dropShadow){let t=e.styleKey;t=t.substring(0,t.lastIndexOf("-")),r=`${t}-bitmap`,n=!1}if(!i.l.has(r)){const t=new y({style:e,overrideFill:n,overrideSize:!0,...this.defaultOptions});b++,b>50&&(0,s.R)("BitmapText",`You have dynamically created ${b} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),t.once("destroy",(()=>{b--,i.l.remove(r)})),i.l.set(r,t)}const a=i.l.get(r);return a.ensureCharacters?.(t),a}getLayout(t,e,r=!0){const i=this.getFont(t,e),n=a.P.graphemeSegmenter(t);return(0,_.Z)(n,e,i,r)}measureText(t,e,r=!0){return this.getLayout(t,e,r)}install(...t){let e=t[0];"string"==typeof e&&(e={name:e,style:t[1],chars:t[2]?.chars,resolution:t[2]?.resolution,padding:t[2]?.padding,skipKerning:t[2]?.skipKerning},(0,n.t6)(n.lj,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const r=e?.name;if(!r)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const s=e.style,a=s instanceof o.x?s:new o.x(s),l=null!==a._fill.fill&&void 0!==a._fill.fill,h=new y({style:a,overrideFill:l,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1,textureStyle:e.textureStyle}),u=function(t){if(""===t)return[];"string"==typeof t&&(t=[t]);const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];if(Array.isArray(i)){if(2!==i.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);if(0===i[0].length||0===i[1].length)throw new Error("[BitmapFont]: Invalid character delimiter.");const t=i[0].charCodeAt(0),r=i[1].charCodeAt(0);if(r<t)throw new Error("[BitmapFont]: Invalid character range.");for(let i=t,n=r;i<=n;i++)e.push(String.fromCharCode(i))}else e.push(...Array.from(i))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(e.chars);return h.ensureCharacters(u.join("")),i.l.set(`${r}-bitmap`,h),h.once("destroy",(()=>i.l.remove(`${r}-bitmap`))),h}uninstall(t){const e=`${t}-bitmap`,r=i.l.get(e);r&&r.destroy()}}},6444:(t,e,r)=>{"use strict";var i=r(8507),n=r(1979),s=r(9408),a=r(4016),o=r(9313),l=r(5611),h=r(4459),u=r(4e3),c=r(6665),d=r(6040),p=r(8475),f=r(5811);const g={name:"local-uniform-msdf-bit",vertex:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32,\n                uRound:f32,\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "},fragment:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n         ",main:"\n            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));\n        "}},x={name:"local-uniform-msdf-bit",vertex:{header:"\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix *= uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "},fragment:{header:"\n            uniform float uDistance;\n         ",main:"\n            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));\n        "}},m={name:"msdf-bit",fragment:{header:"\n            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {\n\n                // MSDF\n                var median = msdfColor.r + msdfColor.g + msdfColor.b -\n                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n\n                // SDF\n                median = min(median, msdfColor.a);\n\n                var screenPxDistance = distance * (median - 0.5);\n                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));\n                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);\n                var coverage: f32 = pow(shapeColor.a * alpha, gamma);\n\n                return coverage;\n\n            }\n        "}},y={name:"msdf-bit",fragment:{header:"\n            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {\n\n                // MSDF\n                float median = msdfColor.r + msdfColor.g + msdfColor.b -\n                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n\n                // SDF\n                median = min(median, msdfColor.a);\n\n                float screenPxDistance = distance * (median - 0.5);\n                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n\n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));\n                float gamma = mix(1.0, 1.0 / 2.2, luma);\n                float coverage = pow(shapeColor.a * alpha, gamma);\n\n                return coverage;\n            }\n        "}};let _,b;class v extends p.M{constructor(t){const e=new f.k({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new o.u,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}});_??(_=(0,l.v)({name:"sdf-shader",bits:[h.F,(0,u._)(t),g,m,c.b]})),b??(b=(0,l.I)({name:"sdf-shader",bits:[h.a,(0,u.P)(t),x,y,c.m]})),super({glProgram:b,gpuProgram:_,resources:{localUniforms:e,batchSamplers:(0,d.n)(t)}})}}var S=r(1312),w=r(2763);class T extends s.A{destroy(){this.context.customShader&&this.context.customShader.destroy(),super.destroy()}}class M{constructor(t){this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuBitmapText")}validateRenderable(t){const e=this._getGpuBitmapText(t);return t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,e)),this._renderer.renderPipes.graphics.validateRenderable(e)}addRenderable(t,e){const r=this._getGpuBitmapText(t);P(t,r),t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,r)),this._renderer.renderPipes.graphics.addRenderable(r,e),r.context.customShader&&this._updateDistanceField(t)}updateRenderable(t){const e=this._getGpuBitmapText(t);P(t,e),this._renderer.renderPipes.graphics.updateRenderable(e),e.context.customShader&&this._updateDistanceField(t)}_updateContext(t,e){const{context:r}=e,i=S.c.getFont(t.text,t._style);r.clear(),"none"!==i.distanceField.type&&(r.customShader||(r.customShader=new v(this._renderer.limits.maxBatchableTextures)));const n=a.P.graphemeSegmenter(t.text),s=t._style;let o=i.baseLineOffset;const l=(0,w.Z)(n,s,i,!0);let h=0;const u=s.padding,c=l.scale;let d=l.width,p=l.height+l.offsetY;s._stroke&&(d+=s._stroke.width/c,p+=s._stroke.width/c),r.translate(-t._anchor._x*d-u,-t._anchor._y*p-u).scale(c,c);const f=i.applyFillAsTint?s._fill.color:16777215;for(let t=0;t<l.lines.length;t++){const e=l.lines[t];for(let t=0;t<e.charPositions.length;t++){const s=n[h++],a=i.chars[s];a?.texture&&r.texture(a.texture,f||"black",Math.round(e.charPositions[t]+a.xOffset),Math.round(o+a.yOffset))}o+=i.lineHeight}}_getGpuBitmapText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const e=new T;return t._gpuData[this._renderer.uid]=e,this._updateContext(t,e),e}_updateDistanceField(t){const e=this._getGpuBitmapText(t).context,r=t._style.fontFamily,i=n.l.get(`${r}-bitmap`),{a:s,b:a,c:o,d:l}=t.groupTransform,h=Math.sqrt(s*s+a*a),u=Math.sqrt(o*o+l*l),c=(Math.abs(h)+Math.abs(u))/2,d=i.baseRenderedFontSize/t._style.fontSize,p=c*i.distanceField.range*(1/d);e.customShader.resources.localUniforms.uniforms.uDistance=p}destroy(){this._renderer=null}}function P(t,e){e.groupTransform=t.groupTransform,e.groupColorAlpha=t.groupColorAlpha,e.groupColor=t.groupColor,e.groupBlendMode=t.groupBlendMode,e.globalDisplayStatus=t.globalDisplayStatus,e.groupTransform=t.groupTransform,e.localDisplayStatus=t.localDisplayStatus,e.groupAlpha=t.groupAlpha,e._roundPixels=t._roundPixels}M.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"bitmapText"},i.XO.add(M)},2763:(t,e,r)=>{"use strict";function i(t,e,r,i){const n={width:0,height:0,offsetY:0,scale:e.fontSize/r.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};n.offsetY=r.baseLineOffset;let s=n.lines[0],a=null,o=!0;const l={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},h=t=>{const e=s.width;for(let r=0;r<l.index;r++){const i=t.positions[r];s.chars.push(t.chars[r]),s.charPositions.push(i+e)}s.width+=t.width,o=!1,l.width=0,l.index=0,l.chars.length=0},u=()=>{let t=s.chars.length-1;if(i){let e=s.chars[t];for(;" "===e;)s.width-=r.chars[e].xAdvance,e=s.chars[--t]}n.width=Math.max(n.width,s.width),s={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,n.lines.push(s),n.height+=r.lineHeight},c=r.baseMeasurementFontSize/e.fontSize,d=e.letterSpacing*c,p=e.wordWrapWidth*c;for(let i=0;i<t.length+1;i++){let n;const c=i===t.length;c||(n=t[i]);const f=r.chars[n]||r.chars[" "];if(/(?:\s)/.test(n)||"\r"===n||"\n"===n||c){if(!o&&e.wordWrap&&s.width+l.width-d>p?(u(),h(l),c||s.charPositions.push(0)):(l.start=s.width,h(l),c||s.charPositions.push(0)),"\r"===n||"\n"===n)0!==s.width&&u();else if(!c){const t=f.xAdvance+(f.kerning[a]||0)+d;s.width+=t,s.spaceWidth=t,s.spacesIndex.push(s.charPositions.length),s.chars.push(n)}}else{const t=f.kerning[a]||0,e=f.xAdvance+t+d;l.positions[l.index++]=l.width+t,l.chars.push(n),l.width+=e}a=n}return u(),"center"===e.align?function(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],i=t.width/2-r.width/2;for(let t=0;t<r.charPositions.length;t++)r.charPositions[t]+=i}}(n):"right"===e.align?function(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],i=t.width-r.width;for(let t=0;t<r.charPositions.length;t++)r.charPositions[t]+=i}}(n):"justify"===e.align&&function(t){const e=t.width;for(let r=0;r<t.lines.length;r++){const i=t.lines[r];let n=0,s=i.spacesIndex[n++],a=0;const o=i.spacesIndex.length,l=(e-i.width)/o;for(let t=0;t<i.charPositions.length;t++)t===s&&(s=i.spacesIndex[n++],a+=l),i.charPositions[t]+=a}}(n),n}r.d(e,{Z:()=>i})},9796:(t,e,r)=>{"use strict";var i=r(8507),n=r(4492),s=r(2289),a=r(8422);class o extends a.K{constructor(t){super(),this.generatingTexture=!1,this._renderer=t,t.runners.resolutionChange.add(this)}resolutionChange(){const t=this.renderable;t._autoResolution&&t.onViewUpdate()}destroy(){this._renderer.htmlText.returnTexturePromise(this.texturePromise),this.texturePromise=null,this._renderer=null}}class l{constructor(t){this._renderer=t}validateRenderable(t){return t._didTextUpdate}addRenderable(t,e){const r=this._getGpuText(t);t._didTextUpdate&&(this._updateGpuText(t).catch((t=>{console.error(t)})),t._didTextUpdate=!1,(0,s.s)(r,t)),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuText(t);e._batcher.updateElement(e)}async _updateGpuText(t){t._didTextUpdate=!1;const e=this._getGpuText(t);if(e.generatingTexture)return;e.texturePromise&&(this._renderer.htmlText.returnTexturePromise(e.texturePromise),e.texturePromise=null),e.generatingTexture=!0,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution;const r=this._renderer.htmlText.getTexturePromise(t);e.texturePromise=r,e.texture=await r;const i=t.renderGroup||t.parentRenderGroup;i&&(i.structureDidChange=!0),e.generatingTexture=!1,(0,s.s)(e,t)}_getGpuText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const e=new o(this._renderer);return e.renderable=t,e.transform=t.groupTransform,e.texture=n.g.EMPTY,e.bounds={minX:0,maxX:1,minY:0,maxY:0},e.roundPixels=this._renderer._roundPixels|t._roundPixels,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,t._gpuData[this._renderer.uid]=e,e}destroy(){this._renderer=null}}l.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"htmlText"};var h=r(7608),u=r(2437),c=r(5099),d=r(1761),p=r(268),f=r(8218),g=r(2558);const x="http://www.w3.org/2000/svg",m="http://www.w3.org/1999/xhtml";class y{constructor(){this.svgRoot=document.createElementNS(x,"svg"),this.foreignObject=document.createElementNS(x,"foreignObject"),this.domElement=document.createElementNS(m,"div"),this.styleElement=document.createElementNS(m,"style"),this.image=new Image;const{foreignObject:t,svgRoot:e,styleElement:r,domElement:i}=this;t.setAttribute("width","10000"),t.setAttribute("height","10000"),t.style.overflow="hidden",e.appendChild(t),t.appendChild(r),t.appendChild(i)}}var _=r(9690),b=r(2577);function v(t){const e=b.Q.shared.setValue(t.color).setAlpha(t.alpha).toHexa(),r=`${Math.round(Math.cos(t.angle)*t.distance)}px ${Math.round(Math.sin(t.angle)*t.distance)}px`;return t.blur>0?`text-shadow: ${r} ${t.blur}px ${e}`:`text-shadow: ${r} ${e}`}function S(t){return[`-webkit-text-stroke-width: ${t.width}px`,`-webkit-text-stroke-color: ${b.Q.shared.setValue(t.color).toHex()}`,`text-stroke-width: ${t.width}px`,`text-stroke-color: ${b.Q.shared.setValue(t.color).toHex()}`,"paint-order: stroke"].join(";")}const w={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},T={fill:t=>`color: ${b.Q.shared.setValue(t).toHex()}`,breakWords:t=>"word-wrap: "+(t?"break-all":"break-word"),stroke:S,dropShadow:v};class M extends _.x{constructor(t={}){super(t),this._cssOverrides=[],this.cssOverrides=t.cssOverrides??[],this.tagStyles=t.tagStyles??{}}set cssOverrides(t){this._cssOverrides=t instanceof Array?t:[t],this.update()}get cssOverrides(){return this._cssOverrides}update(){this._cssStyle=null,super.update()}clone(){return new M({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow?{...this.dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides,tagStyles:{...this.tagStyles}})}get cssStyle(){return this._cssStyle||(this._cssStyle=function(t){const e=t._stroke,r=t._fill,i=[`div { ${[`color: ${b.Q.shared.setValue(r.color).toHex()}`,`font-size: ${t.fontSize}px`,`font-family: ${t.fontFamily}`,`font-weight: ${t.fontWeight}`,`font-style: ${t.fontStyle}`,`font-variant: ${t.fontVariant}`,`letter-spacing: ${t.letterSpacing}px`,`text-align: ${t.align}`,`padding: ${t.padding}px`,`white-space: ${"pre"===t.whiteSpace&&t.wordWrap?"pre-wrap":t.whiteSpace}`,...t.lineHeight?[`line-height: ${t.lineHeight}px`]:[],...t.wordWrap?["word-wrap: "+(t.breakWords?"break-all":"break-word"),`max-width: ${t.wordWrapWidth}px`]:[],...e?[S(e)]:[],...t.dropShadow?[v(t.dropShadow)]:[],...t.cssOverrides].join(";")} }`];return function(t,e){for(const r in t){const i=t[r],n=[];for(const t in i)T[t]?n.push(T[t](i[t])):w[t]&&n.push(w[t].replace("{{VALUE}}",i[t]));e.push(`${r} { ${n.join(";")} }`)}}(t.tagStyles,i),i.join(" ")}(this)),this._cssStyle}addOverride(...t){const e=t.filter((t=>!this.cssOverrides.includes(t)));e.length>0&&(this.cssOverrides.push(...e),this.update())}removeOverride(...t){const e=t.filter((t=>this.cssOverrides.includes(t)));e.length>0&&(this.cssOverrides=this.cssOverrides.filter((t=>!e.includes(t))),this.update())}set fill(t){"string"!=typeof t&&"number"!=typeof t&&(0,p.R)("[HTMLTextStyle] only color fill is not supported by HTMLText"),super.fill=t}set stroke(t){t&&"string"!=typeof t&&"number"!=typeof t&&(0,p.R)("[HTMLTextStyle] only color stroke is not supported by HTMLText"),super.stroke=t}}var P=r(1979);async function C(t,e){const r=await async function(t){const e=await d.e.get().fetch(t),r=await e.blob(),i=new FileReader;return await new Promise(((t,e)=>{i.onloadend=()=>t(i.result),i.onerror=e,i.readAsDataURL(r)}))}(e);return`@font-face {\n        font-family: "${t.fontFamily}";\n        src: url('${r}');\n        font-weight: ${t.fontWeight};\n        font-style: ${t.fontStyle};\n    }`}const k=new Map;let F;class R{constructor(t){this._renderer=t,this._createCanvas=t.type===c.W.WEBGPU}getTexture(t){return this.getTexturePromise(t)}getTexturePromise(t){return this._buildTexturePromise(t)}async _buildTexturePromise(t){const{text:e,style:r,resolution:i,textureStyle:n}=t,s=f.Z.get(y),a=function(t,e){const r=e.fontFamily,i=[],n={},s=t.match(/font-family:([^;"\s]+)/g);function a(t){n[t]||(i.push(t),n[t]=!0)}if(Array.isArray(r))for(let t=0;t<r.length;t++)a(r[t]);else a(r);s&&s.forEach((t=>{a(t.split(":")[1].trim())}));for(const t in e.tagStyles)a(e.tagStyles[t].fontFamily);return i}(e,r),o=await async function(t,e,r){const i=t.filter((t=>P.l.has(`${t}-and-url`))).map(((t,i)=>{if(!k.has(t)){const{url:n}=P.l.get(`${t}-and-url`);0===i?k.set(t,C({fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:t},n)):k.set(t,C({fontWeight:r.fontWeight,fontStyle:r.fontStyle,fontFamily:t},n))}return k.get(t)}));return(await Promise.all(i)).join("\n")}(a,r,M.defaultTextStyle),l=function(t,e,r,i){i||(i=F||(F=new y));const{domElement:n,styleElement:s,svgRoot:a}=i;n.innerHTML=`<style>${e.cssStyle};</style><div style='padding:0'>${t}</div>`,n.setAttribute("style","transform-origin: top left; display: inline-block"),r&&(s.textContent=r),document.body.appendChild(a);const o=n.getBoundingClientRect();a.remove();const l=2*e.padding;return{width:o.width-l,height:o.height-l}}(e,r,o,s),u=Math.ceil(Math.ceil(Math.max(1,l.width)+2*r.padding)*i),c=Math.ceil(Math.ceil(Math.max(1,l.height)+2*r.padding)*i),p=s.image;p.width=2+(0|u),p.height=2+(0|c);const x=function(t,e,r,i,n){const{domElement:s,styleElement:a,svgRoot:o}=n;s.innerHTML=`<style>${e.cssStyle}</style><div style='padding:0;'>${t}</div>`,s.setAttribute("style",`transform: scale(${r});transform-origin: top left; display: inline-block`),a.textContent=i;const{width:l,height:h}=n.image;return o.setAttribute("width",l.toString()),o.setAttribute("height",h.toString()),(new XMLSerializer).serializeToString(o)}(e,r,i,o,s);await function(t,e,r){return new Promise((async i=>{r&&await new Promise((t=>setTimeout(t,100))),t.onload=()=>{i()},t.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(e)}`,t.crossOrigin="anonymous"}))}(p,x,function(){const{userAgent:t}=d.e.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}()&&a.length>0);const m=p;let _;this._createCanvas&&(_=function(t,e){const r=h.N.getOptimalCanvasAndContext(t.width,t.height,e),{context:i}=r;return i.clearRect(0,0,t.width,t.height),i.drawImage(t,0,0),r}(p,i));const b=(0,g.M)(_?_.canvas:m,p.width-2,p.height-2,i);return n&&(b.source.style=n),this._createCanvas&&(this._renderer.texture.initSource(b.source),h.N.returnCanvasAndContext(_)),f.Z.return(s),b}returnTexturePromise(t){t.then((t=>{this._cleanUp(t)})).catch((()=>{(0,p.R)("HTMLTextSystem: Failed to clean texture")}))}_cleanUp(t){u.W.returnTexture(t,!0),t.source.resource=null,t.source.uploadMethodId="unknown"}destroy(){this._renderer=null}}R.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem,i.Ag.CanvasSystem],name:"htmlText"},i.XO.add(R),i.XO.add(l)},9690:(t,e,r)=>{"use strict";r.d(e,{x:()=>p});var i=r(8875),n=r(2577),s=r(4670),a=r(7276),o=r(2806),l=r(5997),h=r(990);const u=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function c(t,e,r){return t?(e[r++]=t.color,e[r++]=t.alpha,e[r++]=t.fill?.styleKey,r):r}const d=class t extends i.A{constructor(e={}){super(),function(t){const e=t;if("boolean"==typeof e.dropShadow&&e.dropShadow){const r=p.defaultDropShadow;t.dropShadow={alpha:e.dropShadowAlpha??r.alpha,angle:e.dropShadowAngle??r.angle,blur:e.dropShadowBlur??r.blur,color:e.dropShadowColor??r.color,distance:e.dropShadowDistance??r.distance}}if(void 0!==e.strokeThickness){(0,s.t6)(s.lj,"strokeThickness is now a part of stroke");const r=e.stroke;let i={};if(n.Q.isColorLike(r))i.color=r;else if(r instanceof a._||r instanceof o.m)i.fill=r;else{if(!Object.hasOwnProperty.call(r,"color")&&!Object.hasOwnProperty.call(r,"fill"))throw new Error("Invalid stroke value.");i=r}t.stroke={...i,width:e.strokeThickness}}if(Array.isArray(e.fillGradientStops)){let r;(0,s.t6)(s.lj,"gradient fill is now a fill pattern: `new FillGradient(...)`"),null==t.fontSize?t.fontSize=p.defaultTextStyle.fontSize:r="string"==typeof t.fontSize?parseInt(t.fontSize,10):t.fontSize;const i=new a._({start:{x:0,y:0},end:{x:0,y:1.7*(r||0)}}),o=e.fillGradientStops.map((t=>n.Q.shared.setValue(t).toNumber()));o.forEach(((t,e)=>{const r=e/(o.length-1);i.addColorStop(r,t)})),t.fill={fill:i}}}(e);const r={...t.defaultTextStyle,...e};for(const t in r)this[t]=r[t];this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow=null!==e&&"object"==typeof e?this._createProxy({...t.defaultDropShadow,...e}):e?this._createProxy({...t.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize="string"==typeof t?parseInt(t,10):t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get filters(){return this._filters}set filters(t){this._filters=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...l.T.defaultFillStyle,...t},(()=>{this._fill=(0,h.w)({...this._originalFill},l.T.defaultFillStyle)}))),this._fill=(0,h.w)(0===t?"black":t,l.T.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...l.T.defaultStrokeStyle,...t},(()=>{this._stroke=(0,h.T)({...this._originalStroke},l.T.defaultStrokeStyle)}))),this._stroke=(0,h.T)(t,l.T.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=function(t){const e=[];let r=0;for(let i=0;i<u.length;i++){const n=`_${u[i]}`;e[r++]=t[n]}return r=c(t._fill,e,r),r=function(t,e,r){return t?(r=c(t,e,r),e[r++]=t.width,e[r++]=t.alignment,e[r++]=t.cap,e[r++]=t.join,e[r++]=t.miterLimit,r):r}(t._stroke,e,r),r=function(t,e,r){return t?(e[r++]=t.alpha,e[r++]=t.angle,e[r++]=t.blur,e[r++]=t.distance,e[r++]=n.Q.shared.setValue(t.color).toNumber(),r):r}(t.dropShadow,e,r),r=function(t,e,r){if(!t)return r;for(const i of t)e[r++]=i.uid;return r}(t.filters,e,r),e.join("-")}(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const e=t.defaultTextStyle;for(const t in e)this[t]=e[t]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new t({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){if(this.removeAllListeners(),"boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.textureSource;this._fill?.texture&&this._fill.texture.destroy(e),this._originalFill?.texture&&this._originalFill.texture.destroy(e),this._stroke?.texture&&this._stroke.texture.destroy(e),this._originalStroke?.texture&&this._originalStroke.texture.destroy(e)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(t,r,i)=>(t[r]=i,e?.(r,i),this.update(),!0)})}_isFillStyle(t){return null!==(t??null)&&!(n.Q.isColorLike(t)||t instanceof a._||t instanceof o.m)}};d.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},d.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let p=d},9492:(t,e,r)=>{"use strict";r.d(e,{v:()=>m});var i=r(2577),n=r(9252),s=r(7608),a=r(1761),o=r(9939);let l=null,h=null;function u(t,e,r){for(let i=0,n=4*r*e;i<e;++i,n+=4)if(0!==t[n+3])return!1;return!0}function c(t,e,r,i,n){const s=4*e;for(let e=i,a=i*s+4*r;e<=n;++e,a+=s)if(0!==t[a+3])return!1;return!0}function d(...t){let e=t[0];e.canvas||(e={canvas:t[0],resolution:t[1]});const{canvas:r}=e,i=Math.min(e.resolution??1,1),s=e.width??r.width,d=e.height??r.height;let p=e.output;if(function(t,e){l||(l=a.e.get().createCanvas(256,128),h=l.getContext("2d",{willReadFrequently:!0}),h.globalCompositeOperation="copy",h.globalAlpha=1),(l.width<t||l.height<e)&&(l.width=(0,o.U5)(t),l.height=(0,o.U5)(e))}(s,d),!h)throw new TypeError("Failed to get canvas 2D context");h.drawImage(r,0,0,s,d,0,0,s*i,d*i);const f=h.getImageData(0,0,s,d).data;let g=0,x=0,m=s-1,y=d-1;for(;x<d&&u(f,s,x);)++x;if(x===d)return n.M.EMPTY;for(;u(f,s,y);)--y;for(;c(f,s,g,x,y);)++g;for(;c(f,s,m,x,y);)--m;return++m,++y,h.globalCompositeOperation="source-over",h.strokeRect(g,x,m-g,y-x),h.globalCompositeOperation="copy",p??(p=new n.M),p.set(g/i,x/i,(m-g)/i,(y-x)/i),p}var p=r(4016),f=r(1242),g=r(3548);const x=new n.M,m=new class{getCanvasAndContext(t){const{text:e,style:r,resolution:i=1}=t,n=r._getFinalPadding(),a=p.P.measureText(e||" ",r),o=Math.ceil(Math.ceil(Math.max(1,a.width)+2*n)*i),l=Math.ceil(Math.ceil(Math.max(1,a.height)+2*n)*i),h=s.N.getOptimalCanvasAndContext(o,l);return this._renderTextToCanvas(e,r,n,i,h),{canvasAndContext:h,frame:r.trim?d({canvas:h.canvas,width:o,height:l,resolution:1,output:x}):x.set(0,0,o,l)}}returnCanvasAndContext(t){s.N.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,r,n,s){const{canvas:a,context:o}=s,l=(0,f.Z)(e),h=p.P.measureText(t||" ",e),u=h.lines,c=h.lineHeight,d=h.lineWidths,x=h.maxLineWidth,m=h.fontProperties,y=a.height;if(o.resetTransform(),o.scale(n,n),o.textBaseline=e.textBaseline,e._stroke?.width){const t=e._stroke;o.lineWidth=t.width,o.miterLimit=t.miterLimit,o.lineJoin=t.join,o.lineCap=t.cap}let _,b;o.font=l;const v=e.dropShadow?2:1;for(let t=0;t<v;++t){const a=e.dropShadow&&0===t,l=a?Math.ceil(Math.max(1,y)+2*r):0,p=l*n;if(a){o.fillStyle="black",o.strokeStyle="black";const t=e.dropShadow,r=t.color,s=t.alpha;o.shadowColor=i.Q.shared.setValue(r).setAlpha(s).toRgbaString();const a=t.blur*n,l=t.distance*n;o.shadowBlur=a,o.shadowOffsetX=Math.cos(t.angle)*l,o.shadowOffsetY=Math.sin(t.angle)*l+p}else{if(o.fillStyle=e._fill?(0,g.r)(e._fill,o,h):null,e._stroke?.width){const t=e._stroke.width*e._stroke.alignment;o.strokeStyle=(0,g.r)(e._stroke,o,h,t)}o.shadowColor="black"}let f=(c-m.fontSize)/2;c-m.fontSize<0&&(f=0);const v=e._stroke?.width??0;for(let t=0;t<u.length;t++)_=v/2,b=v/2+t*c+m.ascent+f,"right"===e.align?_+=x-d[t]:"center"===e.align&&(_+=(x-d[t])/2),e._stroke?.width&&this._drawLetterSpacing(u[t],e,s,_+r,b+r-l,!0),void 0!==e._fill&&this._drawLetterSpacing(u[t],e,s,_+r,b+r-l)}}_drawLetterSpacing(t,e,r,i,n,s=!1){const{context:a}=r,o=e.letterSpacing;let l=!1;if(p.P.experimentalLetterSpacingSupported&&(p.P.experimentalLetterSpacing?(a.letterSpacing=`${o}px`,a.textLetterSpacing=`${o}px`,l=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),0===o||l)return void(s?a.strokeText(t,i,n):a.fillText(t,i,n));let h=i;const u=p.P.graphemeSegmenter(t);let c=a.measureText(t).width,d=0;for(let t=0;t<u.length;++t){const e=u[t];s?a.strokeText(e,h,n):a.fillText(e,h,n);let r="";for(let e=t+1;e<u.length;++e)r+=u[e];d=a.measureText(r).width,h+=c-d+o,c=d}}}},4016:(t,e,r)=>{"use strict";r.d(e,{P:()=>o});var i=r(1761),n=r(1242);const s={willReadFrequently:!0},a=class t{static get experimentalLetterSpacingSupported(){let e=t._experimentalLetterSpacingSupported;if(void 0===e){const r=i.e.get().getCanvasRenderingContext2D().prototype;e=t._experimentalLetterSpacingSupported="letterSpacing"in r||"textLetterSpacing"in r}return e}constructor(t,e,r,i,n,s,a,o,l){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=n,this.lineWidths=s,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=l}static measureText(e=" ",r,i=t._canvas,s=r.wordWrap){const a=(0,n.Z)(r),o=t.measureFont(a);0===o.fontSize&&(o.fontSize=r.fontSize,o.ascent=r.fontSize);const l=t.__context;l.font=a;const h=(s?t._wordWrap(e,r,i):e).split(/(?:\r\n|\r|\n)/),u=new Array(h.length);let c=0;for(let e=0;e<h.length;e++){const i=t._measureText(h[e],r.letterSpacing,l);u[e]=i,c=Math.max(c,i)}const d=r._stroke?.width||0;let p=c+d;r.dropShadow&&(p+=r.dropShadow.distance);const f=r.lineHeight||o.fontSize;let g=Math.max(f,o.fontSize+d)+(h.length-1)*(f+r.leading);return r.dropShadow&&(g+=r.dropShadow.distance),new t(e,r,p,g,h,u,f+r.leading,c,o)}static _measureText(e,r,i){let n=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(i.letterSpacing=`${r}px`,i.textLetterSpacing=`${r}px`,n=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));const s=i.measureText(e);let a=s.width;const o=-s.actualBoundingBoxLeft;let l=s.actualBoundingBoxRight-o;if(a>0)if(n)a-=r,l-=r;else{const i=(t.graphemeSegmenter(e).length-1)*r;a+=i,l+=i}return Math.max(a,l)}static _wordWrap(e,r,i=t._canvas){const n=i.getContext("2d",s);let a=0,o="",l="";const h=Object.create(null),{letterSpacing:u,whiteSpace:c}=r,d=t._collapseSpaces(c),p=t._collapseNewlines(c);let f=!d;const g=r.wordWrapWidth+u,x=t._tokenize(e);for(let e=0;e<x.length;e++){let i=x[e];if(t._isNewline(i)){if(!p){l+=t._addLine(o),f=!d,o="",a=0;continue}i=" "}if(d){const e=t.isBreakingSpace(i),r=t.isBreakingSpace(o[o.length-1]);if(e&&r)continue}const s=t._getFromCache(i,u,h,n);if(s>g)if(""!==o&&(l+=t._addLine(o),o="",a=0),t.canBreakWords(i,r.breakWords)){const e=t.wordWrapSplit(i);for(let s=0;s<e.length;s++){let c=e[s],d=c,p=1;for(;e[s+p];){const n=e[s+p];if(t.canBreakChars(d,n,i,s,r.breakWords))break;c+=n,d=n,p++}s+=p-1;const x=t._getFromCache(c,u,h,n);x+a>g&&(l+=t._addLine(o),f=!1,o="",a=0),o+=c,a+=x}}else{o.length>0&&(l+=t._addLine(o),o="",a=0);const r=e===x.length-1;l+=t._addLine(i,!r),f=!1,o="",a=0}else s+a>g&&(f=!1,l+=t._addLine(o),o="",a=0),(o.length>0||!t.isBreakingSpace(i)||f)&&(o+=i,a+=s)}return l+=t._addLine(o,!1),l}static _addLine(e,r=!0){return e=t._trimRight(e),r?`${e}\n`:e}static _getFromCache(e,r,i,n){let s=i[e];return"number"!=typeof s&&(s=t._measureText(e,r,n)+r,i[e]=s),s}static _collapseSpaces(t){return"normal"===t||"pre-line"===t}static _collapseNewlines(t){return"normal"===t}static _trimRight(e){if("string"!=typeof e)return"";for(let r=e.length-1;r>=0;r--){const i=e[r];if(!t.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static _isNewline(e){return"string"==typeof e&&t._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,r){return"string"==typeof e&&t._breakingSpaces.includes(e.charCodeAt(0))}static _tokenize(e){const r=[];let i="";if("string"!=typeof e)return r;for(let n=0;n<e.length;n++){const s=e[n],a=e[n+1];t.isBreakingSpace(s,a)||t._isNewline(s)?(""!==i&&(r.push(i),i=""),r.push(s)):i+=s}return""!==i&&r.push(i),r}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,i,n){return!0}static wordWrapSplit(e){return t.graphemeSegmenter(e)}static measureFont(e){if(t._fonts[e])return t._fonts[e];const r=t._context;r.font=e;const i=r.measureText(t.METRICS_STRING+t.BASELINE_SYMBOL),n={ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,fontSize:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent};return t._fonts[e]=n,n}static clearMetrics(e=""){e?delete t._fonts[e]:t._fonts={}}static get _canvas(){if(!t.__canvas){let e;try{const r=new OffscreenCanvas(0,0),n=r.getContext("2d",s);if(n?.measureText)return t.__canvas=r,r;e=i.e.get().createCanvas()}catch(t){e=i.e.get().createCanvas()}e.width=e.height=10,t.__canvas=e}return t.__canvas}static get _context(){return t.__context||(t.__context=t._canvas.getContext("2d",s)),t.__context}};a.METRICS_STRING="|q",a.BASELINE_SYMBOL="M",a.BASELINE_MULTIPLIER=1.4,a.HEIGHT_MULTIPLIER=2,a.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>{const r=t.segment(e),i=[];let n=0;for(const t of r)i[n++]=t.segment;return i}}return t=>[...t]})(),a.experimentalLetterSpacing=!1,a._fonts={},a._newlines=[10,13],a._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let o=a},1242:(t,e,r)=>{"use strict";r.d(e,{Z:()=>n});const i=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function n(t){const e="number"==typeof t.fontSize?`${t.fontSize}px`:t.fontSize;let r=t.fontFamily;Array.isArray(t.fontFamily)||(r=t.fontFamily.split(","));for(let t=r.length-1;t>=0;t--){let e=r[t].trim();/([\"\'])[^\'\"]+\1/.test(e)||i.includes(e)||(e=`"${e}"`),r[t]=e}return`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${e} ${r.join(",")}`}},3548:(t,e,r)=>{"use strict";r.d(e,{r:()=>u});var i=r(2577),n=r(9313),s=r(4492),a=r(268),o=r(7276),l=r(2806);const h=1e5;function u(t,e,r,u=0){if(t.texture===s.g.WHITE&&!t.fill)return i.Q.shared.setValue(t.color).setAlpha(t.alpha??1).toHexa();if(!t.fill){const r=e.createPattern(t.texture.source.resource,"repeat"),i=t.matrix.copyTo(n.u.shared);return i.scale(t.texture.frame.width,t.texture.frame.height),r.setTransform(i),r}if(t.fill instanceof l.m){const r=t.fill,i=e.createPattern(r.texture.source.resource,"repeat"),s=r.transform.copyTo(n.u.shared);return s.scale(r.texture.frame.width,r.texture.frame.height),i.setTransform(s),i}if(t.fill instanceof o._){const n=t.fill,s="linear"===n.type,a="local"===n.textureSpace;let o,l=1,c=1;a&&r&&(l=r.width+u,c=r.height+u);let d=!1;if(s){const{start:t,end:r}=n;o=e.createLinearGradient(t.x*l,t.y*c,r.x*l,r.y*c),d=Math.abs(r.x-t.x)<Math.abs(.1*(r.y-t.y))}else{const{center:t,innerRadius:r,outerCenter:i,outerRadius:s}=n;o=e.createRadialGradient(t.x*l,t.y*c,r*l,i.x*l,i.y*c,s*l)}if(d&&a&&r){const t=r.lineHeight/c;for(let e=0;e<r.lines.length;e++){const s=(e*r.lineHeight+u/2)/c;n.colorStops.forEach((e=>{const r=s+e.offset*t;o.addColorStop(Math.floor(r*h)/h,i.Q.shared.setValue(e.color).toHex())}))}}else n.colorStops.forEach((t=>{o.addColorStop(t.offset,i.Q.shared.setValue(t.color).toHex())}));return o}return(0,a.R)("FillStyle not recognised",t),"red"}},2206:(t,e,r)=>{"use strict";var i=r(8507),n=r(2289),s=r(8422);class a extends s.K{constructor(t){super(),this._renderer=t,t.runners.resolutionChange.add(this)}resolutionChange(){const t=this.renderable;t._autoResolution&&t.onViewUpdate()}destroy(){this._renderer.canvasText.returnTexture(this.texture),this._renderer=null}}class o{constructor(t){this._renderer=t}validateRenderable(t){return t._didTextUpdate}addRenderable(t,e){const r=this._getGpuText(t);t._didTextUpdate&&(this._updateGpuText(t),t._didTextUpdate=!1),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuText(t);e._batcher.updateElement(e)}_updateGpuText(t){const e=this._getGpuText(t);e.texture&&this._renderer.canvasText.returnTexture(e.texture),t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,e.texture=e.texture=this._renderer.canvasText.getTexture(t),(0,n.s)(e,t)}_getGpuText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const e=new a(this._renderer);return e.renderable=t,e.transform=t.groupTransform,e.bounds={minX:0,maxX:1,minY:0,maxY:0},e.roundPixels=this._renderer._roundPixels|t._roundPixels,t._gpuData[this._renderer.uid]=e,e}destroy(){this._renderer=null}}o.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"text"};var l=r(2437),h=r(218),u=r(4670),c=r(9690),d=r(2558),p=r(9492);class f{constructor(t){this._renderer=t}getTexture(t,e,r,i){"string"==typeof t&&((0,u.t6)("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),t={text:t,style:r,resolution:e}),t.style instanceof c.x||(t.style=new c.x(t.style)),t.textureStyle instanceof h.n||(t.textureStyle=new h.n(t.textureStyle)),"string"!=typeof t.text&&(t.text=t.text.toString());const{text:n,style:s,textureStyle:a}=t,o=t.resolution??this._renderer.resolution,{frame:l,canvasAndContext:f}=p.v.getCanvasAndContext({text:n,style:s,resolution:o}),g=(0,d.M)(f.canvas,l.width,l.height,o);if(a&&(g.source.style=a),s.trim&&(l.pad(s.padding),g.frame.copyFrom(l),g.updateUvs()),s.filters){const t=this._applyFilters(g,s.filters);return this.returnTexture(g),p.v.returnCanvasAndContext(f),t}return this._renderer.texture.initSource(g._source),p.v.returnCanvasAndContext(f),g}returnTexture(t){const e=t.source;e.resource=null,e.uploadMethodId="unknown",e.alphaMode="no-premultiply-alpha",l.W.returnTexture(t,!0)}renderTextToCanvas(){(0,u.t6)("8.10.0","CanvasTextSystem.renderTextToCanvas: no longer supported, use CanvasTextSystem.getTexture instead")}_applyFilters(t,e){const r=this._renderer.renderTarget.renderTarget,i=this._renderer.filter.generateFilteredTexture({texture:t,filters:e});return this._renderer.renderTarget.bind(r,!1),i}destroy(){this._renderer=null}}f.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem,i.Ag.CanvasSystem],name:"canvasText"},i.XO.add(f),i.XO.add(o)},2558:(t,e,r)=>{"use strict";r.d(e,{M:()=>s});var i=r(2437);const n=new(r(9636).c);function s(t,e,r,s){const a=n;a.minX=0,a.minY=0,a.maxX=t.width/s|0,a.maxY=t.height/s|0;const o=i.W.getOptimalTexture(a.width,a.height,s,!1);return o.source.uploadMethodId="image",o.source.resource=t,o.source.alphaMode="premultiply-alpha-on-upload",o.frame.width=e/s,o.frame.height=r/s,o.source.emit("update",o.source),o.updateUvs(),o}},2289:(t,e,r)=>{"use strict";r.d(e,{s:()=>n});var i=r(2048);function n(t,e){const{texture:r,bounds:n}=t;(0,i.y)(n,e._anchor,r);const s=e._style._getFinalPadding();n.minX-=s,n.minY-=s,n.maxX-=s,n.maxY-=s}}}]);